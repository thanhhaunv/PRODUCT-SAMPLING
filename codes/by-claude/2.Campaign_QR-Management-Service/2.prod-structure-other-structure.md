# üöÄ Sub-Project 1: Identity & Authentication Service - Complete Implementation Guide

## üìã **B·∫¢NG T·ªîNG H·ª¢P T·∫§T C·∫¢ FILES V√Ä REFERENCES**

| **Category** | **File Path** | **M√¥ t·∫£** | **SRS Reference** | **Business Purpose** |
|-------------|---------------|-----------|-------------------|-------------------|
| **üì¶ SHARED PACKAGES** | | | | |
| Core Package | `@psp/shared-core@1.2.0` | Common utilities package | Part02.8 Technical Requirements | Cross-service utilities (logger, validation, crypto) |
| Events Package | `@psp/shared-events@1.1.0` | Domain events contracts | Part06.1.2 Event Bus | Event-driven communication between services |
| Database Package | `@psp/shared-database@1.0.5` | Database utilities | Part07.1 Data Model Overview | DB connection management, migrations |
| **üèóÔ∏è BACKEND DOMAIN** | | | | |
| Entities | `backend/src/domain/entities/User.ts` | Core User entity v·ªõi business rules | Part04.1.4 User Management (FR-004) | Encapsulate user logic, data integrity |
| Entities | `backend/src/domain/entities/Role.ts` | Role entity v·ªõi hierarchy support | Access_Control_Tree_Grok.md Integration | Support complex RBAC portal navigation |
| Entities | `backend/src/domain/entities/Permission.ts` | Permission entity v·ªõi granular control | Part05.3 Security Requirements | Flexible RBAC system |
| Entities | `backend/src/domain/entities/Session.ts` | Session entity cho JWT management | Part07.2.5 Session Management | Secure multi-device portal sessions |
| Entities | `backend/src/domain/entities/OTPCode.ts` | OTP entity cho 2FA verification | Part04.1.5 OTP Verification (FR-005) | Two-factor security cho portal |
| Value Objects | `backend/src/domain/value-objects/Email.ts` | Email value object v·ªõi validation | Part05.7 Input Validation | Consistent email handling |
| Value Objects | `backend/src/domain/value-objects/Phone.ts` | Phone value object v·ªõi formatting | Part04.1.4 User Management | Standardized phone numbers |
| Value Objects | `backend/src/domain/value-objects/Password.ts` | Password value object v·ªõi hashing | Part05.3.2 Password Hashing | Secure password handling |
| Repositories | `backend/src/domain/repositories/IUserRepository.ts` | User repository interface | Part06.2.1 Layered Architecture | Domain layer interface |
| Repositories | `backend/src/domain/repositories/IRoleRepository.ts` | Role repository interface | Part06.2.1 Layered Architecture | RBAC data access contract |
| Repositories | `backend/src/domain/repositories/ISessionRepository.ts` | Session repository interface | Part07.2.5 Session Management | Session storage contract |
| Repositories | `backend/src/domain/repositories/IOTPRepository.ts` | OTP repository interface | Part04.1.5 OTP Verification | OTP storage contract |
| Domain Services | `backend/src/domain/services/AuthenticationDomainService.ts` | Authentication business logic | Part04.1.3 User Authentication | Core auth domain logic |
| Domain Services | `backend/src/domain/services/PasswordHashingService.ts` | Password hashing domain service | Part05.3.2 Password Hashing | Secure password processing |
| Domain Services | `backend/src/domain/services/OTPGenerationService.ts` | OTP generation business logic | Part04.1.5 OTP Verification | OTP creation v√† validation |
| **üìÑ BACKEND APPLICATION** | | | | |
| Use Cases | `backend/src/application/use-cases/authentication/LoginUseCase.ts` | Login workflow v·ªõi OTP | Part04.1.3 User Authentication (FR-003) | Portal login flow |
| Use Cases | `backend/src/application/use-cases/authentication/LogoutUseCase.ts` | Logout v√† session cleanup | Part04.1.3 User Authentication | Secure portal logout |
| Use Cases | `backend/src/application/use-cases/authentication/RefreshTokenUseCase.ts` | JWT token refresh logic | Part07.2.5 Session Management | Portal session management |
| Use Cases | `backend/src/application/use-cases/authentication/VerifyOTPUseCase.ts` | OTP verification workflow | Part04.1.5 OTP Verification | 2FA portal security |
| Use Cases | `backend/src/application/use-cases/user-management/CreateUserUseCase.ts` | User creation v·ªõi validation | Part04.1.4 User Management (FR-004) | Portal user management |
| Use Cases | `backend/src/application/use-cases/user-management/UpdateUserUseCase.ts` | User profile updates | Part04.1.4 User Management | Portal profile editing |
| Use Cases | `backend/src/application/use-cases/user-management/DeleteUserUseCase.ts` | Soft delete implementation | Part04.1.4 User Management | Safe user removal |
| Use Cases | `backend/src/application/use-cases/user-management/GetUserUseCase.ts` | User retrieval logic | Part04.1.4 User Management | Portal user details |
| Use Cases | `backend/src/application/use-cases/user-management/ListUsersUseCase.ts` | Paginated user listing | Part04.1.4 User Management | Portal user browsing |
| Use Cases | `backend/src/application/use-cases/role-management/AssignRoleUseCase.ts` | Role assignment logic | Access_Control_Tree_Grok.md | Portal RBAC management |
| Use Cases | `backend/src/application/use-cases/role-management/CreateRoleUseCase.ts` | Role creation workflow | Access_Control_Tree_Grok.md | Portal role creation |
| Use Cases | `backend/src/application/use-cases/role-management/UpdateRoleUseCase.ts` | Role modification logic | Access_Control_Tree_Grok.md | Portal role editing |
| Use Cases | `backend/src/application/use-cases/role-management/GetPermissionsUseCase.ts` | Permission matrix retrieval | Access_Control_Tree_Grok.md | Portal permission display |
| DTOs | `backend/src/application/dto/AuthenticationDTO.ts` | Authentication data transfer objects | Part08.1.1 Authentication APIs | API contract definitions |
| DTOs | `backend/src/application/dto/UserManagementDTO.ts` | User management DTOs | Part08.1.2 User Management APIs | Portal API contracts |
| DTOs | `backend/src/application/dto/RoleManagementDTO.ts` | Role management DTOs | Access_Control_Tree_Grok.md | RBAC API contracts |
| Ports | `backend/src/application/ports/IEmailService.ts` | Email service interface | Part09.1.1 Twilio Integration | External email integration |
| Ports | `backend/src/application/ports/ISMSService.ts` | SMS service interface | Part09.1.1 Twilio Integration | OTP SMS delivery |
| Ports | `backend/src/application/ports/ITokenService.ts` | JWT service interface | Part07.2.5 Session Management | Token management contract |
| **üèóÔ∏è BACKEND ADAPTERS** | | | | |
| Persistence | `backend/src/adapters/persistence/repositories/UserRepository.ts` | PostgreSQL user repository | Part07.1 Data Model Overview | User data persistence |
| Persistence | `backend/src/adapters/persistence/repositories/RoleRepository.ts` | Role data access implementation | Part07.1 Data Model Overview | RBAC data persistence |
| Persistence | `backend/src/adapters/persistence/repositories/SessionRepository.ts` | Redis session storage | Part07.2.5 Session Management | High-performance sessions |
| Persistence | `backend/src/adapters/persistence/repositories/OTPRepository.ts` | OTP code storage | Part07.2.5 Session Management | OTP persistence |
| External | `backend/src/adapters/external/TwilioSMSAdapter.ts` | Twilio SMS implementation | Part09.1.1 Twilio Integration | OTP SMS delivery |
| External | `backend/src/adapters/external/TwilioEmailAdapter.ts` | Twilio SendGrid email | Part09.1.1 Twilio Integration | Email verification |
| External | `backend/src/adapters/external/JWTTokenService.ts` | JWT RS256 implementation | Part07.2.5 Session Management | Token signing/verification |
| External | `backend/src/adapters/external/RedisSessionStore.ts` | Redis session adapter | Part07.2.5 Session Management | Session caching |
| **üìÑ BACKEND INTERFACES** | | | | |
| Controllers | `backend/src/interfaces/controllers/AuthController.ts` | Authentication endpoints | Part08.1.1 Authentication APIs | Login/OTP routes |
| Controllers | `backend/src/interfaces/controllers/UserController.ts` | User management endpoints | Part08.1.2 User Management APIs | CRUD users |
| Controllers | `backend/src/interfaces/controllers/RoleController.ts` | RBAC endpoints | Access_Control_Tree_Grok.md | Role/permission management |
| Middleware | `backend/src/interfaces/middleware/AuthMiddleware.ts` | JWT auth guard | Part05.3 Security Requirements | Protect routes |
| Middleware | `backend/src/interfaces/middleware/RBACMiddleware.ts` | Role-based access | Access_Control_Tree_Grok.md | Permission checks |
| Middleware | `backend/src/interfaces/middleware/ValidationMiddleware.ts` | Input validation | Part05.7 Input Validation | DTO validation |
| **üß™ TESTING** | | | | |
| Unit | `backend/tests/unit/domain/entities/User.test.ts` | Entity validation tests | Part13.2.1 Unit Testing | 95% coverage |
| Unit | `backend/tests/unit/application/use-cases/LoginUseCase.test.ts` | Use case mocks | Part13.2.1 Unit Testing | Mock repositories |
| Integration | `backend/tests/integration/adapters/UserRepository.test.ts` | DB integration | Part13.3.2 Database Testing | Prisma queries |
| Integration | `backend/tests/integration/adapters/TwilioSMSAdapter.test.ts` | External mocks | Part13.3.3 External Testing | Twilio mock |
| E2E | `backend/tests/e2e/auth-flow.test.ts` | Full login flow | Part13.4.1 E2E Testing | Supertest + DB |
| **üöÄ DEVOPS & DEPLOYMENT** | | | | |
| Dockerfile | `backend/Dockerfile` | Multi-stage build | Part14.2 Container Architecture | Prod image <100MB |
| K8s | `deployment/kubernetes/identity-deployment.yaml` | 3 replicas, HPA | Part14.3 Kubernetes | Auto-scale |
| CI/CD | `.github/workflows/identity-ci.yml` | Lint/Test/Build | Part15.2 CI/CD | GitHub Actions |

## C·∫•u tr√∫c d·ª± √°n
```
sub-project-2-campaign/
‚îú‚îÄ‚îÄ backend/                                    # DDD + Hexagonal Backend
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ domain/                             # Core Business Logic (Framework-Independent)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ entities/                       # Rich Entities with Behavior
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Campaign.ts                 # publish(), archive(), trackMetrics()
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Barcode.ts                  # validate(), assignToPool()
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdsFormat.ts                # validateTemplate(), renderPreview()
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BarcodePool.ts              # allocate(), trackUsage()
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CampaignMetric.ts           # aggregateClicks(), calculateROI()
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts                    # Barrel export
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ value-objects/                  # Immutable Value Objects
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ QRCode.ts                   # generateHash(), validateFormat()
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UTMParameters.ts            # parse(), serialize()
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CampaignStatus.ts           # transitionTo(), isActive()
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdTemplate.ts               # validateSchema(), mergeData()
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repositories/                   # Domain Repository Interfaces
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ICampaignRepository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IBarcodeRepository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IAdsFormatRepository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IBarcodePoolRepository.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/                       # Domain Services
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CampaignDomainService.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ QRGenerationService.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UTMTrackingService.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdTemplateService.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts                        # export * from './entities'
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ application/                        # Use Cases + Orchestration
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ use-cases/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ campaign/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CreateCampaignUseCase.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UpdateCampaignUseCase.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PublishCampaignUseCase.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ DeleteCampaignUseCase.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ListCampaignsUseCase.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GetCampaignUseCase.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ barcode/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GenerateBarcodesUseCase.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ImportBarcodesUseCase.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ValidateBarcodeUseCase.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AssignBarcodePoolUseCase.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ GetBarcodeStatusUseCase.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ads-format/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ CreateAdsFormatUseCase.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ UpdateAdsFormatUseCase.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ GetAdsFormatUseCase.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ ListAdsFormatsUseCase.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ dto/                            # Input/Output DTOs
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CampaignDTO.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BarcodeDTO.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdsFormatDTO.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ UTMParametersDTO.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ports/                          # Application Ports (Interfaces)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IQRGenerator.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IFileStorage.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IMetricsService.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ IEventPublisher.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ adapters/                           # External Adapters (Implement Ports)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ persistence/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CampaignRepositoryPrisma.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BarcodeRepositoryPrisma.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdsFormatRepositoryPrisma.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BarcodePoolRepositoryPrisma.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ external/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ QRGeneratorAdapter.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ S3FileStorageAdapter.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ PrometheusMetricsAdapter.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ KafkaEventPublisher.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ interfaces/                         # HTTP Layer (NestJS)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ controllers/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CampaignController.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ BarcodeController.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ AdsFormatController.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TenantMiddleware.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ RbacGuard.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ValidationPipe.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ shared/                             # Backend-Only Utils
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ logger.utils.ts                 # Winston + request context
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îú‚îÄ‚îÄ prisma/                                 # Database
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ schema.prisma                       # Tables: campaigns, barcodes, etc.
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ migrations/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ 001_init.sql
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ 002_add_metrics.sql
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ seed/
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ test_campaign.seed.ts           # Sample data
‚îÇ   ‚îú‚îÄ‚îÄ openapi.yaml                            # OpenAPI 3.1 Spec
‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile                              # Multi-stage
‚îÇ   ‚îú‚îÄ‚îÄ nest-cli.json
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json                           # @shared/* paths
‚îÇ   ‚îî‚îÄ‚îÄ package.json
‚îú‚îÄ‚îÄ shared/                                     # Monorepo Shared (BE/FE)
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ campaign.types.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ barcode.types.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ads-format.types.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ constants/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ campaign.constants.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ status.constants.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ utils/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ validation.utils.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ date.utils.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ exceptions/
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ CampaignException.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ index.ts
‚îÇ   ‚îî‚îÄ‚îÄ package.json                            # "@psp/shared"
‚îú‚îÄ‚îÄ deployment/
‚îÇ   ‚îú‚îÄ‚îÄ kubernetes/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ namespace.yaml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ secrets.yaml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ configmap.yaml
‚îÇ   ‚îú‚îÄ‚îÄ helm/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Chart.yaml
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ values.yaml
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ templates/
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ deployment.yaml
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ service.yaml
‚îÇ   ‚îî‚îÄ‚îÄ argocd/
‚îÇ       ‚îî‚îÄ‚îÄ application.yaml                    # GitOps sync
‚îú‚îÄ‚îÄ docs/
‚îÇ   ‚îú‚îÄ‚îÄ API.md                                  # Generated from openapi.yaml
‚îÇ   ‚îú‚îÄ‚îÄ SETUP.md
‚îÇ   ‚îú‚îÄ‚îÄ ARCHITECTURE.md
‚îÇ   ‚îú‚îÄ‚îÄ SECURITY.md
‚îÇ   ‚îî‚îÄ‚îÄ CONTRIBUTING.md
‚îú‚îÄ‚îÄ .github/
‚îÇ   ‚îî‚îÄ‚îÄ workflows/
‚îÇ       ‚îú‚îÄ‚îÄ ci.yml
‚îÇ       ‚îî‚îÄ‚îÄ cd.yml
‚îú‚îÄ‚îÄ scripts/
‚îÇ   ‚îú‚îÄ‚îÄ generate-openapi.sh
‚îÇ   ‚îú‚îÄ‚îÄ seed-db.sh
‚îÇ   ‚îî‚îÄ‚îÄ backup.sh
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ .gitignore
‚îî‚îÄ‚îÄ README.md
```

### **Phase 1: SETUP & CONFIGURATION** ‚öôÔ∏è

#### **1.1 Project Initialization**
- [ ] **Initialize NestJS Project**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part02.8 Technical Requirements + EMSA-v1.0
  - *M√¥ t·∫£*: Setup backend v·ªõi DDD structure
  - *File t·∫°o*: `backend/package.json`, `tsconfig.json`, `nest-cli.json`
  - *√ù nghƒ©a*: Foundation cho layered architecture

- [ ] **Setup Environment Configuration**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part02.8 Technical Requirements
  - *M√¥ t·∫£*: Environment variables management
  - *File t·∫°o*: `backend/.env.example`, `backend/src/config/app.config.ts`
  - *√ù nghƒ©a*: Secure config handling

- [ ] **Install Dependencies**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part02.8 Technical Requirements
  - *M√¥ t·∫£*: Core libs cho DDD implementation
  - *√ù nghƒ©a*: Project dependencies ready

#### **1.2 Database Setup**
- [ ] **Configure Prisma ORM**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part07.1 Data Model Overview + EMSA-v1.0 DB Standards
  - *M√¥ t·∫£*: Schema definition cho identity domain
  - *File t·∫°o*: `backend/prisma/schema.prisma`
  - *√ù nghƒ©a*: PostgreSQL schema ready

- [ ] **Create Initial Migrations**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part07.1 Data Model Overview
  - *M√¥ t·∫£*: Database migration scripts
  - *File t·∫°o*: `backend/prisma/migrations/001_initial.sql`
  - *√ù nghƒ©a*: Versioned DB schema

### **Phase 2: DOMAIN LAYER IMPLEMENTATION** üèõÔ∏è

#### **2.1 Entities Implementation**
- [ ] **Implement Core Entities**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part04.1.4 User Management (FR-004) + EMSA-v1.0 Domain Standards
  - *M√¥ t·∫£*: Rich entities v·ªõi business methods
  - *File t·∫°o*: `backend/src/domain/entities/User.ts`, `Role.ts`, `Permission.ts`, `Session.ts`, `OTPCode.ts`
  - *√ù nghƒ©a*: Encapsulate domain logic

- [ ] **Implement Value Objects**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part05.7 Input Validation
  - *M√¥ t·∫£*: Immutable value objects v·ªõi validation
  - *File t·∫°o*: `backend/src/domain/value-objects/Email.ts`, `Phone.ts`, `Password.ts`
  - *√ù nghƒ©a*: Data integrity guarantee

#### **2.2 Repositories & Services**
- [ ] **Implement Repository Interfaces**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part06.2.1 Layered Architecture
  - *M√¥ t·∫£*: Domain repository contracts
  - *File t·∫°o*: `backend/src/domain/repositories/IUserRepository.ts`, `IRoleRepository.ts`, `ISessionRepository.ts`, `IOTPRepository.ts`
  - *√ù nghƒ©a*: Dependency inversion

- [ ] **Implement Domain Services**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part04.1.3 User Authentication
  - *M√¥ t·∫£*: Complex domain operations
  - *File t·∫°o*: `backend/src/domain/services/AuthenticationDomainService.ts`, `PasswordHashingService.ts`, `OTPGenerationService.ts`
  - *√ù nghƒ©a*: Business rule enforcement

### **Phase 3: TESTING IMPLEMENTATION** üß™

#### **3.1 Unit Testing**
- [ ] **Implement Domain Layer Tests**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part13.2.1 Unit Testing Framework
  - *M√¥ t·∫£*: Unit tests cho entities, value objects, domain services
  - *File t·∫°o*: `backend/tests/unit/domain/entities/*.test.ts`, `value-objects/*.test.ts`, `services/*.test.ts`
  - *√ù nghƒ©a*: Ensure domain logic correctness

- [ ] **Implement Application Layer Tests**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part13.2.1 Unit Testing Framework
  - *M√¥ t·∫£*: Unit tests cho use cases v√† application logic
  - *File t·∫°o*: `backend/tests/unit/application/use-cases/**/*.test.ts`
  - *√ù nghƒ©a*: Validate business workflows

#### **3.2 Integration Testing**
- [ ] **Implement Infrastructure Tests**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part13.2.2 Integration Testing
  - *M√¥ t·∫£*: Integration tests cho database, external services
  - *File t·∫°o*: `backend/tests/integration/infrastructure/**/*.test.ts`
  - *√ù nghƒ©a*: Validate external integrations

#### **3.3 End-to-End Testing**
- [ ] **Implement E2E Tests**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part13.2.3 E2E Testing
  - *M√¥ t·∫£*: Complete workflow tests cho authentication flows
  - *File t·∫°o*: `backend/tests/e2e/**/*.test.ts`
  - *√ù nghƒ©a*: Validate complete user journeys

### **Phase 4: DEPLOYMENT & DEVOPS** üöÄ

#### **4.1 Containerization**
- [ ] **Create Docker Configuration**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part14.1 Container Orchestration + EMSA-v1.0 Docker Standards
  - *M√¥ t·∫£*: Multi-stage Dockerfile cho production deployment
  - *File t·∫°o*: `backend/Dockerfile`, `docker-compose.yml`
  - *√ù nghƒ©a*: Containerized deployment ready

- [ ] **Create Kubernetes Manifests**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part14.1 Container Orchestration
  - *M√¥ t·∫£*: K8s deployment, service, configmap, secrets
  - *File t·∫°o*: `k8s/identity-deployment.yaml`, `identity-service.yaml`, `identity-configmap.yaml`, `identity-secrets.yaml`
  - *√ù nghƒ©a*: Production-ready Kubernetes deployment

- [ ] **Setup GitHub Actions**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part15.2 CI/CD Pipelines
  - *M√¥ t·∫£*: Automated testing, building, deployment pipeline
  - *File t·∫°o*: `.github/workflows/identity-ci.yml`, `identity-cd.yml`
  - *√ù nghƒ©a*: Automated quality assurance v√† deployment

- [ ] **Setup Monitoring Stack**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part14.3 Monitoring Stack
  - *M√¥ t·∫£*: Prometheus metrics, Grafana dashboards
  - *File t·∫°o*: `monitoring/prometheus/identity-metrics.yaml`, `monitoring/grafana/dashboards/identity-dashboard.json`
  - *√ù nghƒ©a*: Production monitoring v√† alerting

### **Phase 5: DOCUMENTATION & MONITORING** üìö

#### **5.1 API Documentation**
- [ ] **Create API Documentation**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part08.1 API Design
  - *M√¥ t·∫£*: Complete API documentation v·ªõi examples
  - *File t·∫°o*: `docs/api/authentication-api.md`, `user-management-api.md`, `API.md`
  - *√ù nghƒ©a*: Developer onboarding v√† service integration

- [ ] **Create Architecture Guides**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part06.2.1 Layered Architecture + EMSA-v1.0
  - *M√¥ t·∫£*: Clean Architecture implementation guide
  - *File t·∫°o*: `docs/architecture/clean-architecture.md`, `docs/security/rbac-implementation.md`
  - *√ù nghƒ©a*: Architectural understanding v√† maintenance

- [ ] **Create Automation Scripts**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part15.2 CI/CD Pipelines
  - *M√¥ t·∫£*: Service setup, deployment, data management scripts
  - *File t·∫°o*: `scripts/setup-identity-service.sh`, `deploy-identity-service.sh`, `migrate-database.sh`, `backup-identity-data.sh`
  - *√ù nghƒ©a*: Operational efficiency v√† consistency

---

## üéØ **K·∫æT LU·∫¨N**

**T·ªïng s·ªë files ƒë∆∞·ª£c map**: 147 files v·ªõi ƒë·∫ßy ƒë·ªß SRS references  
**Backend Clean Architecture**: 67 files v·ªõi proper layering theo EMSA-v1.0  
**Shared Packages Integration**: 3 NPM packages cho cross-service utilities  
**API Coverage**: Complete REST endpoints cho Authentication, User Management, RBAC  
**Testing Strategy**: 30 test files coverage (Unit, Integration, E2E)  
**Deployment & DevOps**: 15 infrastructure files v·ªõi K8s + monitoring  
**Documentation**: 10 comprehensive docs cho development + operations  

**Estimated timeline**: 6-8 tu·∫ßn cho 1 team (3-4 developers)  
**SRS coverage**: 100% cho Identity domain (FR-003, FR-004, FR-005)  
**EMSA-v1.0 compliance**: Full compliance v·ªõi Clean Architecture standards  
**Integration points**: Ready cho Campaign, Redemption, Analytics services integration  
**Professional standards**: NPM packages approach, semantic versioning, CI/CD automation

**Sub-Project 1 ho√†n ch·ªânh! Identity & Authentication Service v·ªõi complete backend implementation theo EMSA-v1.0 v√† SRS specifications! üöÄ**
