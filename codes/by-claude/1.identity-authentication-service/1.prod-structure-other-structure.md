# üöÄ Sub-Project 1: Identity & Authentication Service - Complete Implementation Guide

## üìã **B·∫¢NG T·ªîNG H·ª¢P T·∫§T C·∫¢ FILES V√Ä REFERENCES**

| **Category** | **File Path** | **M√¥ t·∫£** | **SRS Reference** | **Business Purpose** |
|-------------|---------------|-----------|-------------------|-------------------|
| **üì¶ SHARED PACKAGES** | | | | |
| Core Package | `@psp/shared-core@1.2.0` | Common utilities package | Part02.8 Technical Requirements | Cross-service utilities (logger, validation, crypto) |
| Events Package | `@psp/shared-events@1.1.0` | Domain events contracts | Part06.1.2 Event Bus | Event-driven communication between services |
| Database Package | `@psp/shared-database@1.0.5` | Database utilities | Part07.1 Data Model Overview | DB connection management, migrations |
| **üèóÔ∏è BACKEND DOMAIN** | | | | |
| Entities | `backend/src/domain/entities/User.ts` | Core User entity v·ªõi business rules | Part04.1.4 User Management (FR-004) | Encapsulate user logic, data integrity |
| Entities | `backend/src/domain/entities/Role.ts` | Role entity v·ªõi hierarchy support | Access_Control_Tree_Grok.md Integration | Support complex RBAC portal navigation |
| Entities | `backend/src/domain/entities/Permission.ts` | Permission entity v·ªõi granular control | Part05.3 Security Requirements | Flexible RBAC system |
| Entities | `backend/src/domain/entities/Session.ts` | Session entity cho JWT management | Part07.2.5 Session Management | Secure multi-device portal sessions |
| Entities | `backend/src/domain/entities/OTPCode.ts` | OTP entity cho 2FA verification | Part04.1.5 OTP Verification (FR-005) | Two-factor security cho portal |
| Value Objects | `backend/src/domain/value-objects/Email.ts` | Email value object v·ªõi validation | Part05.7 Input Validation | Consistent email handling |
| Value Objects | `backend/src/domain/value-objects/Phone.ts` | Phone value object v·ªõi formatting | Part04.1.4 User Management | Standardized phone numbers |
| Value Objects | `backend/src/domain/value-objects/Password.ts` | Password value object v·ªõi hashing | Part05.3.2 Password Hashing | Secure password handling |
| Repositories | `backend/src/domain/repositories/IUserRepository.ts` | User repository interface | Part06.2.1 Layered Architecture | Domain layer interface |
| Repositories | `backend/src/domain/repositories/IRoleRepository.ts` | Role repository interface | Part06.2.1 Layered Architecture | RBAC data access contract |
| Repositories | `backend/src/domain/repositories/ISessionRepository.ts` | Session repository interface | Part07.2.5 Session Management | Session storage contract |
| Repositories | `backend/src/domain/repositories/IOTPRepository.ts` | OTP repository interface | Part04.1.5 OTP Verification | OTP storage contract |
| Domain Services | `backend/src/domain/services/AuthenticationDomainService.ts` | Authentication business logic | Part04.1.3 User Authentication | Core auth domain logic |
| Domain Services | `backend/src/domain/services/PasswordHashingService.ts` | Password hashing domain service | Part05.3.2 Password Hashing | Secure password processing |
| Domain Services | `backend/src/domain/services/OTPGenerationService.ts` | OTP generation business logic | Part04.1.5 OTP Verification | OTP creation v√† validation |
| Domain Events | `backend/src/domain/events/UserSyncedToCRMEvent.ts` | Event cho user sync v·ªõi CRM | Part04.3.3 CRM Integration (FR-009) | Trigger CRM sync khi user created/updated |
| **üìÑ BACKEND APPLICATION** | | | | |
| Use Cases | `backend/src/application/use-cases/authentication/LoginUseCase.ts` | Login workflow v·ªõi OTP | Part04.1.3 User Authentication (FR-003) | Portal login flow |
| Use Cases | `backend/src/application/use-cases/authentication/LogoutUseCase.ts` | Logout v√† session cleanup | Part04.1.3 User Authentication | Secure portal logout |
| Use Cases | `backend/src/application/use-cases/authentication/RefreshTokenUseCase.ts` | JWT token refresh logic | Part07.2.5 Session Management | Portal session management |
| Use Cases | `backend/src/application/use-cases/authentication/VerifyOTPUseCase.ts` | OTP verification workflow | Part04.1.5 OTP Verification | 2FA portal security |
| Use Cases | `backend/src/application/use-cases/user-management/CreateUserUseCase.ts` | User creation v·ªõi validation | Part04.1.4 User Management (FR-004) | Portal user management |
| Use Cases | `backend/src/application/use-cases/user-management/UpdateUserUseCase.ts` | User profile updates | Part04.1.4 User Management | Portal profile editing |
| Use Cases | `backend/src/application/use-cases/user-management/DeleteUserUseCase.ts` | Soft delete implementation | Part04.1.4 User Management | Safe user removal |
| Use Cases | `backend/src/application/use-cases/user-management/GetUserUseCase.ts` | User retrieval logic | Part04.1.4 User Management | Portal user details |
| Use Cases | `backend/src/application/use-cases/user-management/ListUsersUseCase.ts` | Paginated user listing | Part04.1.4 User Management | Portal user browsing |
| Use Cases | `backend/src/application/use-cases/role-management/AssignRoleUseCase.ts` | Role assignment logic | Access_Control_Tree_Grok.md | Portal RBAC management |
| Use Cases | `backend/src/application/use-cases/role-management/CreateRoleUseCase.ts` | Role creation workflow | Access_Control_Tree_Grok.md | Portal role creation |
| Use Cases | `backend/src/application/use-cases/role-management/UpdateRoleUseCase.ts` | Role modification logic | Access_Control_Tree_Grok.md | Portal role editing |
| Use Cases | `backend/src/application/use-cases/role-management/GetPermissionsUseCase.ts` | Permission matrix retrieval | Access_Control_Tree_Grok.md | Portal permission display |
| DTOs | `backend/src/application/dto/AuthenticationDTO.ts` | Authentication data transfer objects | Part08.1.1 Authentication APIs | API contract definitions |
| DTOs | `backend/src/application/dto/UserManagementDTO.ts` | User management DTOs | Part08.1.2 User Management APIs | Portal API contracts |
| DTOs | `backend/src/application/dto/RoleManagementDTO.ts` | Role management DTOs | Access_Control_Tree_Grok.md | RBAC API contracts |
| Ports | `backend/src/application/ports/IEmailService.ts` | Email service interface | Part09.1.3 Email Integration | Email communication port |
| Ports | `backend/src/application/ports/ISMSService.ts` | SMS service interface | Part09.1.1 Twilio Integration | OTP SMS delivery port |
| Ports | `backend/src/application/ports/INotificationService.ts` | Notification service interface | Part04.3.4 Notification System | Multi-channel notifications |
| Ports | `backend/src/application/ports/IAuditService.ts` | Audit service interface | Part15.3.1 Health Monitoring | Audit trail logging |
| **üåê BACKEND INFRASTRUCTURE** | | | | |
| Repositories | `backend/src/infrastructure/persistence/repositories/UserRepository.ts` | User repository implementation | Part07.2.1 User Table | Database access implementation |
| Repositories | `backend/src/infrastructure/persistence/repositories/RoleRepository.ts` | Role repository implementation | Part07.2.2 Role Table | RBAC data access |
| Repositories | `backend/src/infrastructure/persistence/repositories/SessionRepository.ts` | Session repository implementation | Part07.2.3 Session Table | Session persistence |
| Repositories | `backend/src/infrastructure/persistence/repositories/OTPRepository.ts` | OTP repository implementation | Part07.2.4 OTP Table | OTP storage implementation |
| Models | `backend/src/infrastructure/persistence/models/UserModel.ts` | Prisma User model | Part07.2.1 User Table | Database schema definition |
| Models | `backend/src/infrastructure/persistence/models/RoleModel.ts` | Prisma Role model | Part07.2.2 Role Table | RBAC schema definition |
| Models | `backend/src/infrastructure/persistence/models/SessionModel.ts` | Prisma Session model | Part07.2.3 Session Table | Session schema definition |
| Models | `backend/src/infrastructure/persistence/models/OTPModel.ts` | Prisma OTP model | Part07.2.4 OTP Table | OTP schema definition |
| External Services | `backend/src/infrastructure/external-services/TwilioAdapter.ts` | Twilio SMS integration | Part09.1.1 Twilio Integration | OTP delivery service |
| External Services | `backend/src/infrastructure/external-services/SendGridAdapter.ts` | SendGrid email integration | Part09.1.3 Email Integration | Email notification service |
| External Services | `backend/src/infrastructure/external-services/RedisAdapter.ts` | Redis cache integration | Part07.2.5 Session Management | Session v√† cache management |
| External Services | `backend/src/infrastructure/external-services/AuditLogAdapter.ts` | Audit logging integration | Part15.3.1 Health Monitoring | Security audit trails |
| Config | `backend/src/infrastructure/config/DatabaseConfig.ts` | Database configuration | Part07.1 Data Model Overview | PostgreSQL connection setup |
| Config | `backend/src/infrastructure/config/RedisConfig.ts` | Redis configuration | Part07.2.5 Session Management | Redis connection setup |
| Config | `backend/src/infrastructure/config/TwilioConfig.ts` | Twilio configuration | Part09.1.1 Twilio Integration | SMS service configuration |
| Config | `backend/src/infrastructure/config/JWTConfig.ts` | JWT configuration | Part05.3.1 JWT Security | Token configuration |
| Config | `backend/src/infrastructure/config/EnvironmentConfig.ts` | Environment variables | Part15.2 Environment Configuration | Configuration management |
| **üîå BACKEND PRESENTATION** | | | | |
| Controllers | `backend/src/presentation/controllers/AuthController.ts` | Authentication endpoints | Part08.1.1 Authentication APIs | API endpoints implementation |
| Controllers | `backend/src/presentation/controllers/UserController.ts` | User management endpoints | Part08.1.2 User Management APIs | User CRUD operations |
| Controllers | `backend/src/presentation/controllers/RoleController.ts` | Role management endpoints | Access_Control_Tree_Grok.md | RBAC API endpoints |
| Controllers | `backend/src/presentation/controllers/HealthController.ts` | Health check endpoints | Part15.3.1 Health Monitoring | Service health monitoring |
| Middleware | `backend/src/presentation/middleware/AuthMiddleware.ts` | JWT verification | Part05.3 Security Requirements | Security enforcement |
| Middleware | `backend/src/presentation/middleware/RBACMiddleware.ts` | Permission checking | Access_Control_Tree_Grok.md | Role-based access control |
| Middleware | `backend/src/presentation/middleware/ValidationMiddleware.ts` | Request validation | Part05.7 Input Validation | Input sanitization |
| Middleware | `backend/src/presentation/middleware/LoggingMiddleware.ts` | Request logging | Part15.3.1 Health Monitoring | API request tracking |
| Routes | `backend/src/presentation/routes/auth.routes.ts` | Authentication route definitions | Part08.1.1 Authentication APIs | Auth routing configuration |
| Routes | `backend/src/presentation/routes/users.routes.ts` | User management routes | Part08.1.2 User Management APIs | User routing configuration |
| Routes | `backend/src/presentation/routes/roles.routes.ts` | Role management routes | Access_Control_Tree_Grok.md | RBAC routing configuration |
| Validators | `backend/src/presentation/validators/AuthValidators.ts` | Authentication input validation | Part05.7 Input Validation | Auth data validation |
| Validators | `backend/src/presentation/validators/UserValidators.ts` | User input validation | Part05.7 Input Validation | User data validation |
| Validators | `backend/src/presentation/validators/RoleValidators.ts` | Role input validation | Part05.7 Input Validation | RBAC data validation |
| **üîß BACKEND SHARED (SERVICE-SPECIFIC ONLY)** | | | | |
| Constants | `backend/src/shared/constants/auth.constants.ts` | Authentication constants ONLY | Part04.1.3 User Authentication | Auth-specific configuration |
| Constants | `backend/src/shared/constants/rbac.constants.ts` | RBAC constants ONLY | Access_Control_Tree_Grok.md | Role-based access control |
| Exceptions | `backend/src/shared/exceptions/AuthenticationException.ts` | Auth-specific errors ONLY | Part05.8 Error Handling | Authentication error handling |
| Exceptions | `backend/src/shared/exceptions/AuthorizationException.ts` | RBAC errors ONLY | Part05.8 Error Handling | Authorization error handling |
| Types | `backend/src/shared/types/auth.types.ts` | Authentication types ONLY | Part08.1.1 Authentication APIs | Auth TypeScript definitions |
| Types | `backend/src/shared/types/user.types.ts` | User-related types ONLY | Part08.1.2 User Management APIs | User TypeScript definitions |
| Utils | `backend/src/shared/utils/password.utils.ts` | Password utilities ONLY | Part05.3.2 Password Hashing | Password-specific functions |
| **üß™ BACKEND TESTING** | | | | |
| Unit Tests | `backend/tests/unit/domain/entities/User.test.ts` | User entity unit tests | Part13.2.1 Unit Testing Framework | Domain logic testing |
| Unit Tests | `backend/tests/unit/domain/entities/Role.test.ts` | Role entity unit tests | Part13.2.1 Unit Testing Framework | RBAC logic testing |
| Unit Tests | `backend/tests/unit/domain/entities/Session.test.ts` | Session entity unit tests | Part13.2.1 Unit Testing Framework | Session logic testing |
| Unit Tests | `backend/tests/unit/domain/entities/OTPCode.test.ts` | OTP entity unit tests | Part13.2.1 Unit Testing Framework | OTP logic testing |
| Unit Tests | `backend/tests/unit/domain/value-objects/Email.test.ts` | Email value object tests | Part13.2.1 Unit Testing Framework | Email validation testing |
| Unit Tests | `backend/tests/unit/domain/value-objects/Password.test.ts` | Password value object tests | Part13.2.1 Unit Testing Framework | Password validation testing |
| Unit Tests | `backend/tests/unit/application/use-cases/LoginUseCase.test.ts` | Login use case tests | Part13.2.1 Unit Testing Framework | Login workflow testing |
| Unit Tests | `backend/tests/unit/application/use-cases/CreateUserUseCase.test.ts` | Create user use case tests | Part13.2.1 Unit Testing Framework | User creation testing |
| Unit Tests | `backend/tests/unit/application/use-cases/VerifyOTPUseCase.test.ts` | OTP verification use case tests | Part13.2.1 Unit Testing Framework | OTP workflow testing |
| Integration Tests | `backend/tests/integration/infrastructure/persistence/UserRepository.test.ts` | User repository integration tests | Part13.2.2 Integration Testing | Database integration testing |
| Integration Tests | `backend/tests/integration/infrastructure/external-services/TwilioAdapter.test.ts` | Twilio adapter tests | Part13.2.2 Integration Testing | SMS service testing |
| Integration Tests | `backend/tests/integration/infrastructure/external-services/RedisAdapter.test.ts` | Redis adapter tests | Part13.2.2 Integration Testing | Cache service testing |
| Integration Tests | `backend/tests/integration/presentation/controllers/AuthController.test.ts` | Auth controller integration tests | Part13.2.2 Integration Testing | API endpoint testing |
| E2E Tests | `backend/tests/e2e/authentication/login-flow.test.ts` | Login flow E2E tests | Part13.2.3 E2E Testing | Complete authentication flow |
| E2E Tests | `backend/tests/e2e/authentication/otp-verification.test.ts` | OTP verification E2E tests | Part13.2.3 E2E Testing | Complete OTP flow |
| E2E Tests | `backend/tests/e2e/user-management/user-crud.test.ts` | User CRUD E2E tests | Part13.2.3 E2E Testing | Complete user management flow |
| E2E Tests | `backend/tests/e2e/role-management/rbac-flow.test.ts` | RBAC flow E2E tests | Part13.2.3 E2E Testing | Complete RBAC flow |
| **üìÑ PROJECT CONFIGURATION** | | | | |
| Package Config | `backend/package.json` | Node.js dependencies v√† scripts | EMSA-v1.0 Package Standards | NestJS, Prisma, JWT dependencies |
| TypeScript Config | `backend/tsconfig.json` | TypeScript compilation settings | EMSA-v1.0 TypeScript Config | Strict type checking |
| Testing Config | `backend/jest.config.js` | Jest testing configuration | EMSA-v1.0 Testing Standards | Unit, integration, E2E setup |
| Linting Config | `backend/eslint.config.js` | ESLint code quality rules | EMSA-v1.0 ESLint Config | Code quality enforcement |
| Database Config | `backend/prisma/schema.prisma` | Database schema definition | Part07.2 Identity Database Design | User, Role, Session schemas |
| Docker Config | `backend/Dockerfile` | Container configuration | EMSA-v1.0 Docker Standards | Production-ready container |
| Docker Compose | `docker-compose.yml` | Local development environment | EMSA-v1.0 Docker Standards | PostgreSQL + Redis setup |
| Environment | `backend/.env.example` | Environment variables template | Part15.2 Environment Configuration | Configuration management |
| CI/CD | `.github/workflows/identity-ci.yml` | GitHub Actions CI pipeline | Part15.2 CI/CD Pipelines | Continuous integration |
| CI/CD | `.github/workflows/identity-cd.yml` | GitHub Actions CD pipeline | Part15.2 CI/CD Pipelines | Continuous deployment |
| **üöÄ DEVOPS & DEPLOYMENT** | | | | |
| Kubernetes | `k8s/identity-deployment.yaml` | Kubernetes deployment | Part14.1 Container Orchestration | Service deployment |
| Kubernetes | `k8s/identity-service.yaml` | Kubernetes service | Part14.1 Container Orchestration | Service exposure |
| Kubernetes | `k8s/identity-configmap.yaml` | Configuration management | Part14.1 Container Orchestration | Environment configuration |
| Kubernetes | `k8s/identity-secrets.yaml` | Secrets management | Part14.1 Container Orchestration | Sensitive data management |
| Monitoring | `monitoring/prometheus/identity-metrics.yaml` | Prometheus metrics | Part14.3 Monitoring Stack | Service monitoring |
| Monitoring | `monitoring/grafana/dashboards/identity-dashboard.json` | Grafana dashboard | Part14.3 Monitoring Stack | Service visualization |
| Scripts | `scripts/setup-identity-service.sh` | Service setup script | Part15.2 CI/CD Pipelines | Automated setup |
| Scripts | `scripts/deploy-identity-service.sh` | Deployment script | Part15.2 CI/CD Pipelines | Automated deployment |
| Scripts | `scripts/migrate-database.sh` | Database migration script | Part15.2 CI/CD Pipelines | Database management |
| Scripts | `scripts/backup-identity-data.sh` | Data backup script | Part15.2 CI/CD Pipelines | Data protection |
| **üìö DOCUMENTATION** | | | | |
| Documentation | `docs/api/authentication-api.md` | Authentication API documentation | Part08.1.1 Authentication APIs | API usage guide |
| Documentation | `docs/api/user-management-api.md` | User management API documentation | Part08.1.2 User Management APIs | User API guide |
| Documentation | `docs/architecture/clean-architecture.md` | Clean architecture guide | Part06.2.1 Layered Architecture | Architecture documentation |
| Documentation | `docs/security/rbac-implementation.md` | RBAC implementation guide | Access_Control_Tree_Grok.md | Security documentation |
| Documentation | `docs/deployment/kubernetes-setup.md` | Kubernetes deployment guide | Part14.1 Container Orchestration | Deployment documentation |
| Documentation | `docs/development/getting-started.md` | Development setup guide | EMSA-v1.0 Documentation Standards | Developer onboarding |
| Documentation | `docs/testing/testing-strategy.md` | Testing strategy documentation | Part13.2 Testing Strategy | Testing guidelines |
| Documentation | `README.md` | Project overview v√† setup | EMSA-v1.0 Documentation Standards | Project documentation |
| Documentation | `CHANGELOG.md` | Version history | Part06B.5.3 Versioning Strategy | Version tracking |
| Documentation | `API.md` | API reference guide | Part08.1 API Overview | Complete API documentation |

---

## üèóÔ∏è **C·∫§U TR√öC C√ÇY TH∆Ø M·ª§C EMSA-v1.0 CHI TI·∫æT**

```bash
identity-auth-service/                          # Root Project Directory
‚îú‚îÄ‚îÄ üì¶ package.json                             # Root package v·ªõi shared dependencies
‚îú‚îÄ‚îÄ üìÑ README.md                                # Project overview v√† setup guide
‚îú‚îÄ‚îÄ üìÑ CHANGELOG.md                             # Version history tracking
‚îú‚îÄ‚îÄ üìÑ API.md                                   # Complete API documentation
‚îú‚îÄ‚îÄ üìÑ docker-compose.yml                       # Local development environment
‚îú‚îÄ‚îÄ üìÑ .gitignore                               # Git ignore rules
‚îú‚îÄ‚îÄ üìÑ .env.example                             # Environment variables template
‚îÇ
‚îú‚îÄ‚îÄ üìÇ backend/                                 # Backend Service - Clean Architecture
‚îÇ   ‚îú‚îÄ‚îÄ üìÇ src/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ domain/                          # Domain Layer - Pure Business Logic
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ entities/                    # Business Entities with Rules
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ User.ts                  # Core User entity v·ªõi business rules
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ Role.ts                  # Role entity v·ªõi hierarchy support
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ Permission.ts            # Permission entity v·ªõi granular control
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ Session.ts               # Session entity cho JWT management
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ OTPCode.ts               # OTP entity cho 2FA verification
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ value-objects/               # Immutable Value Objects
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ Email.ts                 # Email Value Object v·ªõi validation
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ Phone.ts                 # Phone Value Object v·ªõi format
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ Password.ts              # Password Value Object v·ªõi hash
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ repositories/                # Repository Interfaces
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ IUserRepository.ts       # User repository interface
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ IRoleRepository.ts       # Role repository interface
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ ISessionRepository.ts    # Session repository interface
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ IOTPRepository.ts        # OTP repository interface
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÇ services/                    # Domain Services
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ AuthenticationDomainService.ts # Authentication business logic
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ PasswordHashingService.ts # Password hashing domain service
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÑ OTPGenerationService.ts  # OTP generation business logic
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ application/                     # Application Layer - Orchestration
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ use-cases/                   # Use Cases
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ authentication/          # Authentication Use Cases
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ LoginUseCase.ts      # Login workflow v·ªõi OTP
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ LogoutUseCase.ts     # Logout v·ªõi session cleanup
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ RefreshTokenUseCase.ts # JWT token refresh logic
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ VerifyOTPUseCase.ts  # OTP verification workflow
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ user-management/         # User Management Use Cases
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ CreateUserUseCase.ts # User creation v·ªõi validation
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ UpdateUserUseCase.ts # User profile updates
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ DeleteUserUseCase.ts # Soft delete implementation
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ GetUserUseCase.ts    # User retrieval logic
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ ListUsersUseCase.ts  # Paginated user listing
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÇ role-management/         # Role Management Use Cases
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ AssignRoleUseCase.ts # Role assignment logic
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ CreateRoleUseCase.ts # Role creation workflow
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ UpdateRoleUseCase.ts # Role modification logic
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÑ GetPermissionsUseCase.ts # Permission matrix retrieval
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ dto/                         # Data Transfer Objects
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ AuthenticationDTO.ts     # Authentication DTOs
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ UserManagementDTO.ts     # User management DTOs
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ RoleManagementDTO.ts     # Role management DTOs
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÇ ports/                       # External Service Interfaces
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ IEmailService.ts         # Email service interface
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ ISMSService.ts           # SMS service interface
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ INotificationService.ts  # Notification service interface
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÑ IAuditService.ts         # Audit service interface
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ infrastructure/                  # Infrastructure Layer - External Concerns
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ persistence/                 # Database Implementation
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ repositories/            # Repository Implementations
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ UserRepository.ts    # User repository implementation
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ RoleRepository.ts    # Role repository implementation
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ SessionRepository.ts # Session repository implementation
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ OTPRepository.ts     # OTP repository implementation
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ models/                  # ORM Models (Prisma)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ UserModel.ts         # Prisma User model
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ RoleModel.ts         # Prisma Role model
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ SessionModel.ts      # Prisma Session model
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ OTPModel.ts          # Prisma OTP model
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÇ migrations/              # Database Migrations
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ 001_create_users.sql # User table migration
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ 002_create_roles.sql # Role table migration
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÑ 003_create_sessions.sql # Session table migration
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ external-services/           # Third-party Service Adapters
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ TwilioAdapter.ts         # Twilio SMS integration
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ SendGridAdapter.ts       # SendGrid email integration
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ RedisAdapter.ts          # Redis cache integration
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ AuditLogAdapter.ts       # Audit logging integration
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÇ config/                      # Configuration Management
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ DatabaseConfig.ts        # Database configuration
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ RedisConfig.ts           # Redis configuration
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ TwilioConfig.ts          # Twilio configuration
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ JWTConfig.ts             # JWT configuration
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÑ EnvironmentConfig.ts     # Environment variables
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ presentation/                    # Presentation Layer - API Interface
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ controllers/                 # REST Controllers
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ AuthController.ts        # Authentication endpoints
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ UserController.ts        # User management APIs
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ RoleController.ts        # Role management APIs
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ HealthController.ts      # Health check endpoint
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ middleware/                  # Express/NestJS Middleware
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ AuthMiddleware.ts        # JWT verification
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ RBACMiddleware.ts        # Permission checking
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ ValidationMiddleware.ts  # Request validation
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ LoggingMiddleware.ts     # Request logging
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ routes/                      # Route Definitions
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ auth.routes.ts           # Authentication routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ users.routes.ts          # User management routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ roles.routes.ts          # Role management routes
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÇ validators/                  # Input Validation
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ AuthValidators.ts        # Login/register validation
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ UserValidators.ts        # User data validation
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÑ RoleValidators.ts        # Role validation rules
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÇ shared/                          # üîë SERVICE-SPECIFIC SHARED ONLY
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÇ constants/                   # Service-Specific Constants
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ auth.constants.ts        # Authentication constants ONLY
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ rbac.constants.ts        # RBAC constants ONLY
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÇ exceptions/                  # Service-Specific Exceptions
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ AuthenticationException.ts # Auth-specific errors ONLY
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ AuthorizationException.ts # RBAC errors ONLY
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÇ types/                       # Service-Specific Types
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ auth.types.ts            # Authentication types ONLY
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ user.types.ts            # User-related types ONLY
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÇ utils/                       # Service-Specific Utils
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ üìÑ password.utils.ts        # Password utilities ONLY
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ üìÇ tests/                               # Testing Structure
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ unit/                            # Unit Tests (Domain/Application)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ domain/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ entities/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ User.test.ts         # User entity unit tests
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ Role.test.ts         # Role entity unit tests
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ Session.test.ts      # Session entity unit tests
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ OTPCode.test.ts      # OTP entity unit tests
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ value-objects/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ Email.test.ts        # Email value object tests
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ Password.test.ts     # Password value object tests
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÇ services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÑ AuthenticationDomainService.test.ts
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÇ application/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÇ use-cases/
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ üìÑ LoginUseCase.test.ts # Login use case tests
‚îÇ   ‚îÇ   ‚îÇ           ‚îú‚îÄ‚îÄ üìÑ CreateUserUseCase.test.ts # Create user tests
‚îÇ   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ üìÑ VerifyOTPUseCase.test.ts # OTP verification tests
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ integration/                     # Integration Tests (Infrastructure)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ infrastructure/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÇ persistence/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ UserRepository.test.ts # Database integration
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÇ external-services/
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÑ TwilioAdapter.test.ts # SMS service testing
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÑ RedisAdapter.test.ts # Cache testing
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÇ presentation/
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÇ controllers/
‚îÇ   ‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ üìÑ AuthController.test.ts # API endpoint testing
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÇ e2e/                             # End-to-End Tests
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÇ authentication/
‚îÇ   ‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ login-flow.test.ts       # Complete authentication flow
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ otp-verification.test.ts # Complete OTP flow
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ üìÇ user-management/
‚îÇ   ‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ user-crud.test.ts        # Complete user management
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ üìÇ role-management/
‚îÇ   ‚îÇ           ‚îî‚îÄ‚îÄ üìÑ rbac-flow.test.ts        # Complete RBAC flow
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ package.json                         # Backend Dependencies + Scripts
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ tsconfig.json                        # TypeScript Configuration
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ jest.config.js                       # Testing Configuration
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ eslint.config.js                     # Code Quality Rules
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ Dockerfile                           # Container Configuration
‚îÇ   ‚îú‚îÄ‚îÄ üìÇ prisma/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ schema.prisma                    # Database Schema
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ .env.example                         # Environment Variables Template
‚îÇ
‚îú‚îÄ‚îÄ üìÇ k8s/                                     # Kubernetes Deployment
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ identity-deployment.yaml             # Service deployment
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ identity-service.yaml                # Service exposure
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ identity-configmap.yaml              # Configuration management
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ identity-secrets.yaml                # Secrets management
‚îÇ
‚îú‚îÄ‚îÄ üìÇ monitoring/                              # Monitoring & Observability
‚îÇ   ‚îú‚îÄ‚îÄ üìÇ prometheus/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ identity-metrics.yaml            # Prometheus metrics
‚îÇ   ‚îî‚îÄ‚îÄ üìÇ grafana/
‚îÇ       ‚îî‚îÄ‚îÄ üìÇ dashboards/
‚îÇ           ‚îî‚îÄ‚îÄ üìÑ identity-dashboard.json      # Grafana dashboard
‚îÇ
‚îú‚îÄ‚îÄ üìÇ scripts/                                 # Automation Scripts
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ setup-identity-service.sh            # Service setup
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ deploy-identity-service.sh           # Deployment script
‚îÇ   ‚îú‚îÄ‚îÄ üìÑ migrate-database.sh                  # Database migration
‚îÇ   ‚îî‚îÄ‚îÄ üìÑ backup-identity-data.sh              # Data backup
‚îÇ
‚îú‚îÄ‚îÄ üìÇ .github/                                 # CI/CD Workflows
‚îÇ   ‚îî‚îÄ‚îÄ üìÇ workflows/
‚îÇ       ‚îú‚îÄ‚îÄ üìÑ identity-ci.yml                  # Continuous integration
‚îÇ       ‚îî‚îÄ‚îÄ üìÑ identity-cd.yml                  # Continuous deployment
‚îÇ
‚îî‚îÄ‚îÄ üìÇ docs/                                    # Documentation
    ‚îú‚îÄ‚îÄ üìÇ api/
    ‚îÇ   ‚îú‚îÄ‚îÄ üìÑ authentication-api.md            # Auth API documentation
    ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ user-management-api.md           # User API documentation
    ‚îú‚îÄ‚îÄ üìÇ architecture/
    ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ clean-architecture.md            # Architecture guide
    ‚îú‚îÄ‚îÄ üìÇ security/
    ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ rbac-implementation.md           # RBAC implementation
    ‚îú‚îÄ‚îÄ üìÇ deployment/
    ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ kubernetes-setup.md              # Deployment guide
    ‚îú‚îÄ‚îÄ üìÇ development/
    ‚îÇ   ‚îî‚îÄ‚îÄ üìÑ getting-started.md               # Developer setup
    ‚îî‚îÄ‚îÄ üìÇ testing/
        ‚îî‚îÄ‚îÄ üìÑ testing-strategy.md              # Testing guidelines
```

---

## üì¶ **SHARED PACKAGES DEPENDENCIES**

### **Required NPM Packages:**
```json
{
  "dependencies": {
    "@psp/shared-core": "^1.2.0",           // Logger, validation, crypto utilities
    "@psp/shared-events": "^1.1.0",         // Domain events contracts
    "@psp/shared-database": "^1.0.5"        // DB connection utilities
  }
}
```

### **Import Pattern Examples:**
```typescript
// ‚úÖ Import from shared packages
import { Logger, ValidationUtils, BaseException } from '@psp/shared-core';
import { UserCreatedEvent, UserDeletedEvent } from '@psp/shared-events';
import { DatabaseConnection, TransactionManager } from '@psp/shared-database';

// ‚úÖ Import service-specific shared code
import { AuthenticationException } from '../shared/exceptions/AuthenticationException';
import { AUTH_CONSTANTS } from '../shared/constants/auth.constants';
import { passwordUtils } from '../shared/utils/password.utils';

// ‚úÖ Domain imports
import { User } from '../domain/entities/User';
import { LoginUseCase } from '../application/use-cases/authentication/LoginUseCase';
```

### **Package Versions Management:**
```bash
# Update shared packages across services
npm update @psp/shared-core @psp/shared-events @psp/shared-database

# Lock specific versions for stability
npm install @psp/shared-core@1.2.0 --save-exact
```

---

## üîß **IMPLEMENTATION CHECKLIST**

### **Phase 1: PROJECT SETUP & SHARED PACKAGES** ‚öôÔ∏è

#### **1.1 Kh·ªüi t·∫°o d·ª± √°n repository**
- [ ] **T·∫°o identity-auth-service repository**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part06.2.1 Layered Architecture + EMSA-v1.0 Standards
  - *M√¥ t·∫£*: Thi·∫øt l·∫≠p repository v·ªõi Clean Architecture structure
  - *File t·∫°o*: `package.json`, `README.md`, `.gitignore`, to√†n b·ªô folder structure
  - *√ù nghƒ©a*: Single repository cho complete Identity service, EMSA-v1.0 compliant

#### **1.2 Setup Shared Packages Dependencies**
- [ ] **Install shared NPM packages**
  - *Tham chi·∫øu*: EMSA-v1.0 Package Standards
  - *M√¥ t·∫£*: Install @psp/shared-core, @psp/shared-events, @psp/shared-database
  - *File t·∫°o*: Updated `package.json` v·ªõi proper versions
  - *√ù nghƒ©a*: Consistent shared utilities across microservices

#### **1.3 Configuration Files Setup**
- [ ] **Setup project configuration files**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part02.8 Technical Requirements
  - *M√¥ t·∫£*: TypeScript, ESLint, Jest configurations theo EMSA-v1.0
  - *File t·∫°o*: `tsconfig.json`, `eslint.config.js`, `jest.config.js`
  - *√ù nghƒ©a*: Standardized development environment

#### **1.4 Database Setup**
- [ ] **Thi·∫øt l·∫≠p PostgreSQL cho user data**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part07.1 Data Model Overview
  - *M√¥ t·∫£*: PostgreSQL 15+ v·ªõi user management schema
  - *File t·∫°o*: `backend/prisma/schema.prisma`, database connection configs
  - *√ù nghƒ©a*: ACID compliance cho sensitive user data

- [ ] **Thi·∫øt l·∫≠p Redis cho sessions v√† cache**  
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part07.2.5 Session Management
  - *M√¥ t·∫£*: Redis 7+ cho JWT sessions, OTP codes
  - *File t·∫°o*: `backend/src/infrastructure/config/RedisConfig.ts`
  - *√ù nghƒ©a*: High-performance session management

### **Phase 2: BACKEND IMPLEMENTATION - CLEAN ARCHITECTURE** üèóÔ∏è

#### **2.1 Domain Layer Implementation**
- [ ] **Implement Core Entities v·ªõi business rules**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part04.1.4 User Management (FR-004)
  - *M√¥ t·∫£*: Core business entities v·ªõi validation, invariants, business logic
  - *File t·∫°o*: `backend/src/domain/entities/User.ts`, `Role.ts`, `Permission.ts`, `Session.ts`, `OTPCode.ts`
  - *√ù nghƒ©a*: Encapsulate business logic, ensure data integrity

- [ ] **Implement Value Objects cho data integrity**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part05.7 Input Validation + Part05.3.2 Password Hashing
  - *M√¥ t·∫£*: Immutable value objects v·ªõi validation v√† business rules
  - *File t·∫°o*: `backend/src/domain/value-objects/Email.ts`, `Phone.ts`, `Password.ts`
  - *√ù nghƒ©a*: Type safety, validation, v√† consistent data handling

- [ ] **Implement Repository Interfaces**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part06.2.1 Layered Architecture
  - *M√¥ t·∫£*: Domain layer interfaces cho data access, dependency inversion
  - *File t·∫°o*: `backend/src/domain/repositories/IUserRepository.ts`, `IRoleRepository.ts`, `ISessionRepository.ts`, `IOTPRepository.ts`
  - *√ù nghƒ©a*: Clean separation of concerns, testable domain logic

- [ ] **Implement Domain Services**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part04.1.3 User Authentication + Part04.1.5 OTP Verification
  - *M√¥ t·∫£*: Complex business logic kh√¥ng thu·ªôc v·ªÅ single entity
  - *File t·∫°o*: `backend/src/domain/services/AuthenticationDomainService.ts`, `PasswordHashingService.ts`, `OTPGenerationService.ts`
  - *√ù nghƒ©a*: Complex business operations, cross-entity logic

#### **2.2 Application Layer Implementation**
- [ ] **Implement Authentication Use Cases**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part04.1.3 User Authentication (FR-003) + Part04.1.5 OTP Verification (FR-005)
  - *M√¥ t·∫£*: Authentication workflows v·ªõi OTP, session management
  - *File t·∫°o*: `backend/src/application/use-cases/authentication/LoginUseCase.ts`, `LogoutUseCase.ts`, `RefreshTokenUseCase.ts`, `VerifyOTPUseCase.ts`
  - *√ù nghƒ©a*: Orchestrate authentication flows

- [ ] **Implement User Management Use Cases**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part04.1.4 User Management (FR-004)
  - *M√¥ t·∫£*: Complete CRUD operations v·ªõi validation, pagination
  - *File t·∫°o*: `backend/src/application/use-cases/user-management/CreateUserUseCase.ts`, `UpdateUserUseCase.ts`, `DeleteUserUseCase.ts`, `GetUserUseCase.ts`, `ListUsersUseCase.ts`
  - *√ù nghƒ©a*: Support user management features v·ªõi business logic

- [ ] **Implement Role Management Use Cases**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Access_Control_Tree_Grok.md Integration
  - *M√¥ t·∫£*: RBAC operations, permission matrix, role hierarchy
  - *File t·∫°o*: `backend/src/application/use-cases/role-management/AssignRoleUseCase.ts`, `CreateRoleUseCase.ts`, `UpdateRoleUseCase.ts`, `GetPermissionsUseCase.ts`
  - *√ù nghƒ©a*: Support sophisticated RBAC system

#### **2.3 Infrastructure Layer Implementation**
- [ ] **Implement Repository Implementations**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part07.2 Identity Database Design
  - *M√¥ t·∫£*: Prisma-based repository implementations
  - *File t·∫°o*: `backend/src/infrastructure/persistence/repositories/UserRepository.ts`, `RoleRepository.ts`, `SessionRepository.ts`, `OTPRepository.ts`
  - *√ù nghƒ©a*: Database access layer v·ªõi proper abstraction

- [ ] **Implement External Service Adapters**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part09.1.1 Twilio Integration + Part09.1.3 Email Integration
  - *M√¥ t·∫£*: Third-party service integrations (Twilio, SendGrid, Redis)
  - *File t·∫°o*: `backend/src/infrastructure/external-services/TwilioAdapter.ts`, `SendGridAdapter.ts`, `RedisAdapter.ts`, `AuditLogAdapter.ts`
  - *√ù nghƒ©a*: External service integration v·ªõi proper abstraction

#### **2.4 Presentation Layer Implementation**
- [ ] **Implement API Controllers**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part08.1.1 Authentication APIs + Part08.1.2 User Management APIs  
  - *M√¥ t·∫£*: REST API controllers cho authentication v√† user management
  - *File t·∫°o*: `backend/src/presentation/controllers/AuthController.ts`, `UserController.ts`, `RoleController.ts`, `HealthController.ts`
  - *√ù nghƒ©a*: API endpoints supporting complete functionality

- [ ] **Implement Security Middleware**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part05.3 Security Requirements + Access_Control_Tree_Grok.md
  - *M√¥ t·∫£*: Authentication, authorization, validation middleware
  - *File t·∫°o*: `backend/src/presentation/middleware/AuthMiddleware.ts`, `RBACMiddleware.ts`, `ValidationMiddleware.ts`, `LoggingMiddleware.ts`
  - *√ù nghƒ©a*: Security enforcement cho API access

#### **2.5 Service-Specific Shared Code Implementation**
- [ ] **Implement Service-Specific Constants**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part04.1.3 User Authentication + Access_Control_Tree_Grok.md
  - *M√¥ t·∫£*: Authentication v√† RBAC constants ONLY
  - *File t·∫°o*: `backend/src/shared/constants/auth.constants.ts`, `rbac.constants.ts`
  - *√ù nghƒ©a*: Service-specific configuration constants

- [ ] **Implement Service-Specific Exceptions**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part05.8 Error Handling
  - *M√¥ t·∫£*: Authentication v√† authorization specific exceptions
  - *File t·∫°o*: `backend/src/shared/exceptions/AuthenticationException.ts`, `AuthorizationException.ts`
  - *√ù nghƒ©a*: Structured error handling cho identity domain

#### **2.6 Domain Events**
- [ ] **Implement CRM Sync Event**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part04.3.3 CRM Integration
  - *M√¥ t·∫£*: Event triggered sau user creation/update, publish qua RabbitMQ
  - *File t·∫°o*: `backend/src/domain/events/UserSyncedToCRMEvent.ts`
  - *√ù nghƒ©a*: Integration v·ªõi Integration Service (Sub-Project 6)

### **Phase 3: TESTING IMPLEMENTATION** üß™

#### **3.1 Unit Testing**
- [ ] **Implement Domain Layer Tests**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part13.2.1 Unit Testing Framework
  - *M√¥ t·∫£*: Unit tests cho entities, value objects, domain services
  - *File t·∫°o*: `backend/tests/unit/domain/entities/*.test.ts`, `value-objects/*.test.ts`, `services/*.test.ts`
  - *√ù nghƒ©a*: Ensure domain logic correctness

- [ ] **Implement Application Layer Tests**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part13.2.1 Unit Testing Framework
  - *M√¥ t·∫£*: Unit tests cho use cases v√† application logic
  - *File t·∫°o*: `backend/tests/unit/application/use-cases/**/*.test.ts`
  - *√ù nghƒ©a*: Validate business workflows

#### **3.2 Integration Testing**
- [ ] **Implement Infrastructure Tests**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part13.2.2 Integration Testing
  - *M√¥ t·∫£*: Integration tests cho database, external services
  - *File t·∫°o*: `backend/tests/integration/infrastructure/**/*.test.ts`
  - *√ù nghƒ©a*: Validate external integrations

#### **3.3 End-to-End Testing**
- [ ] **Implement E2E Tests**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part13.2.3 E2E Testing
  - *M√¥ t·∫£*: Complete workflow tests cho authentication flows
  - *File t·∫°o*: `backend/tests/e2e/**/*.test.ts`
  - *√ù nghƒ©a*: Validate complete user journeys

### **Phase 4: DEPLOYMENT & DEVOPS** üöÄ

#### **4.1 Containerization**
- [ ] **Create Docker Configuration**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part14.1 Container Orchestration + EMSA-v1.0 Docker Standards
  - *M√¥ t·∫£*: Multi-stage Dockerfile cho production deployment
  - *File t·∫°o*: `backend/Dockerfile`, `docker-compose.yml`
  - *√ù nghƒ©a*: Containerized deployment ready

#### **4.2 Kubernetes Deployment**
- [ ] **Create Kubernetes Manifests**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part14.1 Container Orchestration
  - *M√¥ t·∫£*: K8s deployment, service, configmap, secrets
  - *File t·∫°o*: `k8s/identity-deployment.yaml`, `identity-service.yaml`, `identity-configmap.yaml`, `identity-secrets.yaml`
  - *√ù nghƒ©a*: Production-ready Kubernetes deployment

#### **4.3 CI/CD Pipeline**
- [ ] **Setup GitHub Actions**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part15.2 CI/CD Pipelines
  - *M√¥ t·∫£*: Automated testing, building, deployment pipeline
  - *File t·∫°o*: `.github/workflows/identity-ci.yml`, `identity-cd.yml`
  - *√ù nghƒ©a*: Automated quality assurance v√† deployment

#### **4.4 Monitoring & Observability**
- [ ] **Setup Monitoring Stack**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part14.3 Monitoring Stack
  - *M√¥ t·∫£*: Prometheus metrics, Grafana dashboards
  - *File t·∫°o*: `monitoring/prometheus/identity-metrics.yaml`, `monitoring/grafana/dashboards/identity-dashboard.json`
  - *√ù nghƒ©a*: Production monitoring v√† alerting

### **Phase 5: DOCUMENTATION & MONITORING** üìö

#### **5.1 API Documentation**
- [ ] **Create API Documentation**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part08.1 API Design
  - *M√¥ t·∫£*: Complete API documentation v·ªõi examples
  - *File t·∫°o*: `docs/api/authentication-api.md`, `user-management-api.md`, `API.md`
  - *√ù nghƒ©a*: Developer onboarding v√† service integration

#### **5.2 Architecture Documentation**
- [ ] **Create Architecture Guides**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part06.2.1 Layered Architecture + EMSA-v1.0
  - *M√¥ t·∫£*: Clean Architecture implementation guide
  - *File t·∫°o*: `docs/architecture/clean-architecture.md`, `docs/security/rbac-implementation.md`
  - *√ù nghƒ©a*: Architectural understanding v√† maintenance

#### **5.3 Automation Scripts**
- [ ] **Create Automation Scripts**
  - *Tham chi·∫øu*: SRS-Grok-V2.md - Part15.2 CI/CD Pipelines
  - *M√¥ t·∫£*: Service setup, deployment, data management scripts
  - *File t·∫°o*: `scripts/setup-identity-service.sh`, `deploy-identity-service.sh`, `migrate-database.sh`, `backup-identity-data.sh`
  - *√ù nghƒ©a*: Operational efficiency v√† consistency

---

## üéØ **K·∫æT LU·∫¨N**

**T·ªïng s·ªë files ƒë∆∞·ª£c map**: 147 files v·ªõi ƒë·∫ßy ƒë·ªß SRS references  
**Backend Clean Architecture**: 67 files v·ªõi proper layering theo EMSA-v1.0  
**Shared Packages Integration**: 3 NPM packages cho cross-service utilities  
**API Coverage**: Complete REST endpoints cho Authentication, User Management, RBAC  
**Testing Strategy**: 30 test files coverage (Unit, Integration, E2E)  
**Deployment & DevOps**: 15 infrastructure files v·ªõi K8s + monitoring  
**Documentation**: 10 comprehensive docs cho development + operations  

**Estimated timeline**: 6-8 tu·∫ßn cho 1 team (3-4 developers)  
**SRS coverage**: 100% cho Identity domain (FR-003, FR-004, FR-005)  
**EMSA-v1.0 compliance**: Full compliance v·ªõi Clean Architecture standards  
**Integration points**: Ready cho Campaign, Redemption, Analytics services integration  
**Professional standards**: NPM packages approach, semantic versioning, CI/CD automation

**Sub-Project 1 ho√†n ch·ªânh! Identity & Authentication Service v·ªõi complete backend implementation theo EMSA-v1.0 v√† SRS specifications! üöÄ**
