# ğŸš€ Sub-Project 1: Identity & Authentication Service - Complete Implementation Guide

## ğŸ“‹ **Báº¢NG Tá»”NG Há»¢P Táº¤T Cáº¢ FILES VÃ€ REFERENCES**

| **Category** | **File Path** | **MÃ´ táº£** | **SRS Reference** | **Business Purpose** |
|-------------|---------------|-----------|-------------------|-------------------|
| **ğŸ“¦ SHARED PACKAGES** | | | | |
| Core Package | `@psp/shared-core@1.2.0` | Common utilities package | Part02.8 Technical Requirements | Cross-service utilities (logger, validation, crypto) |
| Events Package | `@psp/shared-events@1.1.0` | Domain events contracts | Part06.1.2 Event Bus | Event-driven communication between services |
| Database Package | `@psp/shared-database@1.0.5` | Database utilities | Part07.1 Data Model Overview | DB connection management, migrations |
| **ğŸ—ï¸ BACKEND DOMAIN** | | | | |
| Entities | `backend/src/domain/entities/User.ts` | Core User entity vá»›i business rules | Part04.1.4 User Management (FR-004) | Encapsulate user logic, data integrity |
| Entities | `backend/src/domain/entities/Role.ts` | Role entity vá»›i hierarchy support | Access_Control_Tree_Grok.md Integration | Support complex RBAC portal navigation |
| Entities | `backend/src/domain/entities/Permission.ts` | Permission entity vá»›i granular control | Part05.3 Security Requirements | Flexible RBAC system |
| Entities | `backend/src/domain/entities/Session.ts` | Session entity cho JWT management | Part07.2.5 Session Management | Secure multi-device portal sessions |
| Entities | `backend/src/domain/entities/OTPCode.ts` | OTP entity cho 2FA verification | Part04.1.5 OTP Verification (FR-005) | Two-factor security cho portal |
| Value Objects | `backend/src/domain/value-objects/Email.ts` | Email value object vá»›i validation | Part05.7 Input Validation | Consistent email handling |
| Value Objects | `backend/src/domain/value-objects/Phone.ts` | Phone value object vá»›i formatting | Part04.1.4 User Management | Standardized phone numbers |
| Value Objects | `backend/src/domain/value-objects/Password.ts` | Password value object vá»›i hashing | Part05.3.2 Password Hashing | Secure password handling |
| Repositories | `backend/src/domain/repositories/IUserRepository.ts` | User repository interface | Part06.2.1 Layered Architecture | Domain layer interface |
| Repositories | `backend/src/domain/repositories/IRoleRepository.ts` | Role repository interface | Part06.2.1 Layered Architecture | RBAC data access contract |
| Repositories | `backend/src/domain/repositories/ISessionRepository.ts` | Session repository interface | Part07.2.5 Session Management | Session storage contract |
| Repositories | `backend/src/domain/repositories/IOTPRepository.ts` | OTP repository interface | Part04.1.5 OTP Verification | OTP storage contract |
| Domain Services | `backend/src/domain/services/AuthenticationDomainService.ts` | Authentication business logic | Part04.1.3 User Authentication | Core auth domain logic |
| Domain Services | `backend/src/domain/services/PasswordHashingService.ts` | Password hashing domain service | Part05.3.2 Password Hashing | Secure password processing |
| Domain Services | `backend/src/domain/services/OTPGenerationService.ts` | OTP generation business logic | Part04.1.5 OTP Verification | OTP creation vÃ  validation |
| Domain Events | `backend/src/domain/events/UserSyncedToCRMEvent.ts` | Event cho user sync vá»›i CRM | Part04.3.3 CRM Integration (FR-009) | Trigger CRM sync khi user created/updated |
| **ğŸ“„ BACKEND APPLICATION** | | | | |
| Use Cases | `backend/src/application/use-cases/authentication/LoginUseCase.ts` | Login workflow vá»›i OTP | Part04.1.3 User Authentication (FR-003) | Portal login flow |
| Use Cases | `backend/src/application/use-cases/authentication/LogoutUseCase.ts` | Logout vÃ  session cleanup | Part04.1.3 User Authentication | Secure portal logout |
| Use Cases | `backend/src/application/use-cases/authentication/RefreshTokenUseCase.ts` | JWT token refresh logic | Part07.2.5 Session Management | Portal session management |
| Use Cases | `backend/src/application/use-cases/authentication/VerifyOTPUseCase.ts` | OTP verification workflow | Part04.1.5 OTP Verification | 2FA portal security |
| Use Cases | `backend/src/application/use-cases/user-management/CreateUserUseCase.ts` | User creation vá»›i validation | Part04.1.4 User Management (FR-004) | Portal user management |
| Use Cases | `backend/src/application/use-cases/user-management/UpdateUserUseCase.ts` | User profile updates | Part04.1.4 User Management | Portal profile editing |
| Use Cases | `backend/src/application/use-cases/user-management/DeleteUserUseCase.ts` | Soft delete implementation | Part04.1.4 User Management | Safe user removal |
| Use Cases | `backend/src/application/use-cases/user-management/GetUserUseCase.ts` | User retrieval logic | Part04.1.4 User Management | Portal user details |
| Use Cases | `backend/src/application/use-cases/user-management/ListUsersUseCase.ts` | Paginated user listing | Part04.1.4 User Management | Portal user browsing |
| Use Cases | `backend/src/application/use-cases/role-management/AssignRoleUseCase.ts` | Role assignment logic | Access_Control_Tree_Grok.md | Portal RBAC management |
| Use Cases | `backend/src/application/use-cases/role-management/CreateRoleUseCase.ts` | Role creation workflow | Access_Control_Tree_Grok.md | Portal role creation |
| Use Cases | `backend/src/application/use-cases/role-management/UpdateRoleUseCase.ts` | Role modification logic | Access_Control_Tree_Grok.md | Portal role editing |
| Use Cases | `backend/src/application/use-cases/role-management/GetPermissionsUseCase.ts` | Permission matrix retrieval | Access_Control_Tree_Grok.md | Portal permission display |
| DTOs | `backend/src/application/dto/AuthenticationDTO.ts` | Authentication data transfer objects | Part08.1.1 Authentication APIs | API contract definitions |
| DTOs | `backend/src/application/dto/UserManagementDTO.ts` | User management DTOs | Part08.1.2 User Management APIs | Portal API contracts |
| DTOs | `backend/src/application/dto/RoleManagementDTO.ts` | Role management DTOs | Access_Control_Tree_Grok.md | RBAC API contracts |
| Ports | `backend/src/application/ports/IEmailService.ts` | Email service interface | Part09.1.3 Email Integration | Email communication port |
| Ports | `backend/src/application/ports/ISMSService.ts` | SMS service interface | Part09.1.1 Twilio Integration | OTP SMS delivery port |
| Ports | `backend/src/application/ports/INotificationService.ts` | Notification service interface | Part04.3.4 Notification System | Multi-channel notifications |
| Ports | `backend/src/application/ports/IAuditService.ts` | Audit service interface | Part15.3.1 Health Monitoring | Audit trail logging |
| **ğŸŒ BACKEND INFRASTRUCTURE** | | | | |
| Repositories | `backend/src/infrastructure/persistence/repositories/UserRepository.ts` | User repository implementation | Part07.2.1 User Table | Database access implementation |
| Repositories | `backend/src/infrastructure/persistence/repositories/RoleRepository.ts` | Role repository implementation | Part07.2.2 Role Table | RBAC data access |
| Repositories | `backend/src/infrastructure/persistence/repositories/SessionRepository.ts` | Session repository implementation | Part07.2.3 Session Table | Session persistence |
| Repositories | `backend/src/infrastructure/persistence/repositories/OTPRepository.ts` | OTP repository implementation | Part07.2.4 OTP Table | OTP storage implementation |
| Models | `backend/src/infrastructure/persistence/models/UserModel.ts` | Prisma User model | Part07.2.1 User Table | Database schema definition |
| Models | `backend/src/infrastructure/persistence/models/RoleModel.ts` | Prisma Role model | Part07.2.2 Role Table | RBAC schema definition |
| Models | `backend/src/infrastructure/persistence/models/SessionModel.ts` | Prisma Session model | Part07.2.3 Session Table | Session schema definition |
| Models | `backend/src/infrastructure/persistence/models/OTPModel.ts` | Prisma OTP model | Part07.2.4 OTP Table | OTP schema definition |
| External Services | `backend/src/infrastructure/external-services/TwilioAdapter.ts` | Twilio SMS integration | Part09.1.1 Twilio Integration | OTP delivery service |
| External Services | `backend/src/infrastructure/external-services/SendGridAdapter.ts` | SendGrid email integration | Part09.1.3 Email Integration | Email notification service |
| External Services | `backend/src/infrastructure/external-services/RedisAdapter.ts` | Redis cache integration | Part07.2.5 Session Management | Session vÃ  cache management |
| External Services | `backend/src/infrastructure/external-services/AuditLogAdapter.ts` | Audit logging integration | Part15.3.1 Health Monitoring | Security audit trails |
| Config | `backend/src/infrastructure/config/DatabaseConfig.ts` | Database configuration | Part07.1 Data Model Overview | PostgreSQL connection setup |
| Config | `backend/src/infrastructure/config/RedisConfig.ts` | Redis configuration | Part07.2.5 Session Management | Redis connection setup |
| Config | `backend/src/infrastructure/config/TwilioConfig.ts` | Twilio configuration | Part09.1.1 Twilio Integration | SMS service configuration |
| Config | `backend/src/infrastructure/config/JWTConfig.ts` | JWT configuration | Part05.3.1 JWT Security | Token configuration |
| Config | `backend/src/infrastructure/config/EnvironmentConfig.ts` | Environment variables | Part15.2 Environment Configuration | Configuration management |
| **ğŸ”Œ BACKEND PRESENTATION** | | | | |
| Controllers | `backend/src/presentation/controllers/AuthController.ts` | Authentication endpoints | Part08.1.1 Authentication APIs | API endpoints implementation |
| Controllers | `backend/src/presentation/controllers/UserController.ts` | User management endpoints | Part08.1.2 User Management APIs | User CRUD operations |
| Controllers | `backend/src/presentation/controllers/RoleController.ts` | Role management endpoints | Access_Control_Tree_Grok.md | RBAC API endpoints |
| Controllers | `backend/src/presentation/controllers/HealthController.ts` | Health check endpoints | Part15.3.1 Health Monitoring | Service health monitoring |
| Middleware | `backend/src/presentation/middleware/AuthMiddleware.ts` | JWT verification | Part05.3 Security Requirements | Security enforcement |
| Middleware | `backend/src/presentation/middleware/RBACMiddleware.ts` | Permission checking | Access_Control_Tree_Grok.md | Role-based access control |
| Middleware | `backend/src/presentation/middleware/ValidationMiddleware.ts` | Request validation | Part05.7 Input Validation | Input sanitization |
| Middleware | `backend/src/presentation/middleware/LoggingMiddleware.ts` | Request logging | Part15.3.1 Health Monitoring | API request tracking |
| Routes | `backend/src/presentation/routes/auth.routes.ts` | Authentication route definitions | Part08.1.1 Authentication APIs | Auth routing configuration |
| Routes | `backend/src/presentation/routes/users.routes.ts` | User management routes | Part08.1.2 User Management APIs | User routing configuration |
| Routes | `backend/src/presentation/routes/roles.routes.ts` | Role management routes | Access_Control_Tree_Grok.md | RBAC routing configuration |
| Validators | `backend/src/presentation/validators/AuthValidators.ts` | Authentication input validation | Part05.7 Input Validation | Auth data validation |
| Validators | `backend/src/presentation/validators/UserValidators.ts` | User input validation | Part05.7 Input Validation | User data validation |
| Validators | `backend/src/presentation/validators/RoleValidators.ts` | Role input validation | Part05.7 Input Validation | RBAC data validation |
| **ğŸ”§ BACKEND SHARED (SERVICE-SPECIFIC ONLY)** | | | | |
| Constants | `backend/src/shared/constants/auth.constants.ts` | Authentication constants ONLY | Part04.1.3 User Authentication | Auth-specific configuration |
| Constants | `backend/src/shared/constants/rbac.constants.ts` | RBAC constants ONLY | Access_Control_Tree_Grok.md | Role-based access control |
| Exceptions | `backend/src/shared/exceptions/AuthenticationException.ts` | Auth-specific errors ONLY | Part05.8 Error Handling | Authentication error handling |
| Exceptions | `backend/src/shared/exceptions/AuthorizationException.ts` | RBAC errors ONLY | Part05.8 Error Handling | Authorization error handling |
| Types | `backend/src/shared/types/auth.types.ts` | Authentication types ONLY | Part08.1.1 Authentication APIs | Auth TypeScript definitions |
| Types | `backend/src/shared/types/user.types.ts` | User-related types ONLY | Part08.1.2 User Management APIs | User TypeScript definitions |
| Utils | `backend/src/shared/utils/password.utils.ts` | Password utilities ONLY | Part05.3.2 Password Hashing | Password-specific functions |
| **ğŸ§ª BACKEND TESTING** | | | | |
| Unit Tests | `backend/tests/unit/domain/entities/User.test.ts` | User entity unit tests | Part13.2.1 Unit Testing Framework | Domain logic testing |
| Unit Tests | `backend/tests/unit/domain/entities/Role.test.ts` | Role entity unit tests | Part13.2.1 Unit Testing Framework | RBAC logic testing |
| Unit Tests | `backend/tests/unit/domain/entities/Session.test.ts` | Session entity unit tests | Part13.2.1 Unit Testing Framework | Session logic testing |
| Unit Tests | `backend/tests/unit/domain/entities/OTPCode.test.ts` | OTP entity unit tests | Part13.2.1 Unit Testing Framework | OTP logic testing |
| Unit Tests | `backend/tests/unit/domain/value-objects/Email.test.ts` | Email value object tests | Part13.2.1 Unit Testing Framework | Email validation testing |
| Unit Tests | `backend/tests/unit/domain/value-objects/Password.test.ts` | Password value object tests | Part13.2.1 Unit Testing Framework | Password validation testing |
| Unit Tests | `backend/tests/unit/application/use-cases/LoginUseCase.test.ts` | Login use case tests | Part13.2.1 Unit Testing Framework | Login workflow testing |
| Unit Tests | `backend/tests/unit/application/use-cases/CreateUserUseCase.test.ts` | Create user use case tests | Part13.2.1 Unit Testing Framework | User creation testing |
| Unit Tests | `backend/tests/unit/application/use-cases/VerifyOTPUseCase.test.ts` | OTP verification use case tests | Part13.2.1 Unit Testing Framework | OTP workflow testing |
| Integration Tests | `backend/tests/integration/infrastructure/persistence/UserRepository.test.ts` | User repository integration tests | Part13.2.2 Integration Testing | Database integration testing |
| Integration Tests | `backend/tests/integration/infrastructure/external-services/TwilioAdapter.test.ts` | Twilio adapter tests | Part13.2.2 Integration Testing | SMS service testing |
| Integration Tests | `backend/tests/integration/infrastructure/external-services/RedisAdapter.test.ts` | Redis adapter tests | Part13.2.2 Integration Testing | Cache service testing |
| Integration Tests | `backend/tests/integration/presentation/controllers/AuthController.test.ts` | Auth controller integration tests | Part13.2.2 Integration Testing | API endpoint testing |
| E2E Tests | `backend/tests/e2e/authentication/login-flow.test.ts` | Login flow E2E tests | Part13.2.3 E2E Testing | Complete authentication flow |
| E2E Tests | `backend/tests/e2e/authentication/otp-verification.test.ts` | OTP verification E2E tests | Part13.2.3 E2E Testing | Complete OTP flow |
| E2E Tests | `backend/tests/e2e/user-management/user-crud.test.ts` | User CRUD E2E tests | Part13.2.3 E2E Testing | Complete user management flow |
| E2E Tests | `backend/tests/e2e/role-management/rbac-flow.test.ts` | RBAC flow E2E tests | Part13.2.3 E2E Testing | Complete RBAC flow |
| **ğŸ“„ PROJECT CONFIGURATION** | | | | |
| Package Config | `backend/package.json` | Node.js dependencies vÃ  scripts | EMSA-v1.0 Package Standards | NestJS, Prisma, JWT dependencies |
| TypeScript Config | `backend/tsconfig.json` | TypeScript compilation settings | EMSA-v1.0 TypeScript Config | Strict type checking |
| Testing Config | `backend/jest.config.js` | Jest testing configuration | EMSA-v1.0 Testing Standards | Unit, integration, E2E setup |
| Linting Config | `backend/eslint.config.js` | ESLint code quality rules | EMSA-v1.0 ESLint Config | Code quality enforcement |
| Database Config | `backend/prisma/schema.prisma` | Database schema definition | Part07.2 Identity Database Design | User, Role, Session schemas |
| Docker Config | `backend/Dockerfile` | Container configuration | EMSA-v1.0 Docker Standards | Production-ready container |
| Docker Compose | `docker-compose.yml` | Local development environment | EMSA-v1.0 Docker Standards | PostgreSQL + Redis setup |
| Environment | `backend/.env.example` | Environment variables template | Part15.2 Environment Configuration | Configuration management |
| CI/CD | `.github/workflows/identity-ci.yml` | GitHub Actions CI pipeline | Part15.2 CI/CD Pipelines | Continuous integration |
| CI/CD | `.github/workflows/identity-cd.yml` | GitHub Actions CD pipeline | Part15.2 CI/CD Pipelines | Continuous deployment |
| **ğŸš€ DEVOPS & DEPLOYMENT** | | | | |
| Kubernetes | `k8s/identity-deployment.yaml` | Kubernetes deployment | Part14.1 Container Orchestration | Service deployment |
| Kubernetes | `k8s/identity-service.yaml` | Kubernetes service | Part14.1 Container Orchestration | Service exposure |
| Kubernetes | `k8s/identity-configmap.yaml` | Configuration management | Part14.1 Container Orchestration | Environment configuration |
| Kubernetes | `k8s/identity-secrets.yaml` | Secrets management | Part14.1 Container Orchestration | Sensitive data management |
| Monitoring | `monitoring/prometheus/identity-metrics.yaml` | Prometheus metrics | Part14.3 Monitoring Stack | Service monitoring |
| Monitoring | `monitoring/grafana/dashboards/identity-dashboard.json` | Grafana dashboard | Part14.3 Monitoring Stack | Service visualization |
| Scripts | `scripts/setup-identity-service.sh` | Service setup script | Part15.2 CI/CD Pipelines | Automated setup |
| Scripts | `scripts/deploy-identity-service.sh` | Deployment script | Part15.2 CI/CD Pipelines | Automated deployment |
| Scripts | `scripts/migrate-database.sh` | Database migration script | Part15.2 CI/CD Pipelines | Database management |
| Scripts | `scripts/backup-identity-data.sh` | Data backup script | Part15.2 CI/CD Pipelines | Data protection |
| **ğŸ“š DOCUMENTATION** | | | | |
| Documentation | `docs/api/authentication-api.md` | Authentication API documentation | Part08.1.1 Authentication APIs | API usage guide |
| Documentation | `docs/api/user-management-api.md` | User management API documentation | Part08.1.2 User Management APIs | User API guide |
| Documentation | `docs/architecture/clean-architecture.md` | Clean architecture guide | Part06.2.1 Layered Architecture | Architecture documentation |
| Documentation | `docs/security/rbac-implementation.md` | RBAC implementation guide | Access_Control_Tree_Grok.md | Security documentation |
| Documentation | `docs/deployment/kubernetes-setup.md` | Kubernetes deployment guide | Part14.1 Container Orchestration | Deployment documentation |
| Documentation | `docs/development/getting-started.md` | Development setup guide | EMSA-v1.0 Documentation Standards | Developer onboarding |
| Documentation | `docs/testing/testing-strategy.md` | Testing strategy documentation | Part13.2 Testing Strategy | Testing guidelines |
| Documentation | `README.md` | Project overview vÃ  setup | EMSA-v1.0 Documentation Standards | Project documentation |
| Documentation | `CHANGELOG.md` | Version history | Part06B.5.3 Versioning Strategy | Version tracking |
| Documentation | `API.md` | API reference guide | Part08.1 API Overview | Complete API documentation |

---

## ğŸ—ï¸ **Cáº¤U TRÃšC CÃ‚Y THÆ¯ Má»¤C EMSA-v1.0 CHI TIáº¾T**

```bash
identity-auth-service/                          # Root Project Directory
â”œâ”€â”€ ğŸ“¦ package.json                             # Root package vá»›i shared dependencies
â”œâ”€â”€ ğŸ“„ README.md                                # Project overview vÃ  setup guide
â”œâ”€â”€ ğŸ“„ CHANGELOG.md                             # Version history tracking
â”œâ”€â”€ ğŸ“„ API.md                                   # Complete API documentation
â”œâ”€â”€ ğŸ“„ docker-compose.yml                       # Local development environment
â”œâ”€â”€ ğŸ“„ .gitignore                               # Git ignore rules
â”œâ”€â”€ ğŸ“„ .env.example                             # Environment variables template
â”‚
â”œâ”€â”€ ğŸ“‚ backend/                                 # Backend Service - Clean Architecture
â”‚   â”œâ”€â”€ ğŸ“‚ src/
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ domain/                          # Domain Layer - Pure Business Logic
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ entities/                    # Business Entities with Rules
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ User.ts                  # Core User entity vá»›i business rules
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Role.ts                  # Role entity vá»›i hierarchy support
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Permission.ts            # Permission entity vá»›i granular control
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Session.ts               # Session entity cho JWT management
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ OTPCode.ts               # OTP entity cho 2FA verification
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ value-objects/               # Immutable Value Objects
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Email.ts                 # Email Value Object vá»›i validation
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Phone.ts                 # Phone Value Object vá»›i format
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ Password.ts              # Password Value Object vá»›i hash
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ repositories/                # Repository Interfaces
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ IUserRepository.ts       # User repository interface
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ IRoleRepository.ts       # Role repository interface
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ISessionRepository.ts    # Session repository interface
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ IOTPRepository.ts        # OTP repository interface
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“‚ services/                    # Domain Services
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ AuthenticationDomainService.ts # Authentication business logic
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ PasswordHashingService.ts # Password hashing domain service
â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“„ OTPGenerationService.ts  # OTP generation business logic
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ application/                     # Application Layer - Orchestration
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ use-cases/                   # Use Cases
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ authentication/          # Authentication Use Cases
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LoginUseCase.ts      # Login workflow vá»›i OTP
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ LogoutUseCase.ts     # Logout vá»›i session cleanup
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ RefreshTokenUseCase.ts # JWT token refresh logic
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ VerifyOTPUseCase.ts  # OTP verification workflow
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ user-management/         # User Management Use Cases
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ CreateUserUseCase.ts # User creation vá»›i validation
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UpdateUserUseCase.ts # User profile updates
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ DeleteUserUseCase.ts # Soft delete implementation
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ GetUserUseCase.ts    # User retrieval logic
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ ListUsersUseCase.ts  # Paginated user listing
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“‚ role-management/         # Role Management Use Cases
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ AssignRoleUseCase.ts # Role assignment logic
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ CreateRoleUseCase.ts # Role creation workflow
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ UpdateRoleUseCase.ts # Role modification logic
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“„ GetPermissionsUseCase.ts # Permission matrix retrieval
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ dto/                         # Data Transfer Objects
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ AuthenticationDTO.ts     # Authentication DTOs
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserManagementDTO.ts     # User management DTOs
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ RoleManagementDTO.ts     # Role management DTOs
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“‚ ports/                       # External Service Interfaces
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ IEmailService.ts         # Email service interface
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ ISMSService.ts           # SMS service interface
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ INotificationService.ts  # Notification service interface
â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“„ IAuditService.ts         # Audit service interface
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ infrastructure/                  # Infrastructure Layer - External Concerns
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ persistence/                 # Database Implementation
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ repositories/            # Repository Implementations
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserRepository.ts    # User repository implementation
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ RoleRepository.ts    # Role repository implementation
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ SessionRepository.ts # Session repository implementation
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ OTPRepository.ts     # OTP repository implementation
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ models/                  # ORM Models (Prisma)
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserModel.ts         # Prisma User model
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ RoleModel.ts         # Prisma Role model
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ SessionModel.ts      # Prisma Session model
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ OTPModel.ts          # Prisma OTP model
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“‚ migrations/              # Database Migrations
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ 001_create_users.sql # User table migration
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ 002_create_roles.sql # Role table migration
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“„ 003_create_sessions.sql # Session table migration
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ external-services/           # Third-party Service Adapters
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ TwilioAdapter.ts         # Twilio SMS integration
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ SendGridAdapter.ts       # SendGrid email integration
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ RedisAdapter.ts          # Redis cache integration
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ AuditLogAdapter.ts       # Audit logging integration
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“‚ config/                      # Configuration Management
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ DatabaseConfig.ts        # Database configuration
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ RedisConfig.ts           # Redis configuration
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ TwilioConfig.ts          # Twilio configuration
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ JWTConfig.ts             # JWT configuration
â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“„ EnvironmentConfig.ts     # Environment variables
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ presentation/                    # Presentation Layer - API Interface
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ controllers/                 # REST Controllers
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ AuthController.ts        # Authentication endpoints
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ UserController.ts        # User management APIs
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ RoleController.ts        # Role management APIs
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ HealthController.ts      # Health check endpoint
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ middleware/                  # Express/NestJS Middleware
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ AuthMiddleware.ts        # JWT verification
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ RBACMiddleware.ts        # Permission checking
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ ValidationMiddleware.ts  # Request validation
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ LoggingMiddleware.ts     # Request logging
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ routes/                      # Route Definitions
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ auth.routes.ts           # Authentication routes
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ users.routes.ts          # User management routes
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ roles.routes.ts          # Role management routes
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“‚ validators/                  # Input Validation
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ AuthValidators.ts        # Login/register validation
â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ UserValidators.ts        # User data validation
â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“„ RoleValidators.ts        # Role validation rules
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ ğŸ“‚ shared/                          # ğŸ”‘ SERVICE-SPECIFIC SHARED ONLY
â”‚   â”‚       â”œâ”€â”€ ğŸ“‚ constants/                   # Service-Specific Constants
â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“„ auth.constants.ts        # Authentication constants ONLY
â”‚   â”‚       â”‚   â””â”€â”€ ğŸ“„ rbac.constants.ts        # RBAC constants ONLY
â”‚   â”‚       â”œâ”€â”€ ğŸ“‚ exceptions/                  # Service-Specific Exceptions
â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“„ AuthenticationException.ts # Auth-specific errors ONLY
â”‚   â”‚       â”‚   â””â”€â”€ ğŸ“„ AuthorizationException.ts # RBAC errors ONLY
â”‚   â”‚       â”œâ”€â”€ ğŸ“‚ types/                       # Service-Specific Types
â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“„ auth.types.ts            # Authentication types ONLY
â”‚   â”‚       â”‚   â””â”€â”€ ğŸ“„ user.types.ts            # User-related types ONLY
â”‚   â”‚       â””â”€â”€ ğŸ“‚ utils/                       # Service-Specific Utils
â”‚   â”‚           â””â”€â”€ ğŸ“„ password.utils.ts        # Password utilities ONLY
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“‚ tests/                               # Testing Structure
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ unit/                            # Unit Tests (Domain/Application)
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ domain/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ entities/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ User.test.ts         # User entity unit tests
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Role.test.ts         # Role entity unit tests
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Session.test.ts      # Session entity unit tests
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ OTPCode.test.ts      # OTP entity unit tests
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ value-objects/
â”‚   â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“„ Email.test.ts        # Email value object tests
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ Password.test.ts     # Password value object tests
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“‚ services/
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“„ AuthenticationDomainService.test.ts
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“‚ application/
â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“‚ use-cases/
â”‚   â”‚   â”‚           â”œâ”€â”€ ğŸ“„ LoginUseCase.test.ts # Login use case tests
â”‚   â”‚   â”‚           â”œâ”€â”€ ğŸ“„ CreateUserUseCase.test.ts # Create user tests
â”‚   â”‚   â”‚           â””â”€â”€ ğŸ“„ VerifyOTPUseCase.test.ts # OTP verification tests
â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ integration/                     # Integration Tests (Infrastructure)
â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ infrastructure/
â”‚   â”‚   â”‚   â”‚   â”œâ”€â”€ ğŸ“‚ persistence/
â”‚   â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“„ UserRepository.test.ts # Database integration
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“‚ external-services/
â”‚   â”‚   â”‚   â”‚       â”œâ”€â”€ ğŸ“„ TwilioAdapter.test.ts # SMS service testing
â”‚   â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“„ RedisAdapter.test.ts # Cache testing
â”‚   â”‚   â”‚   â””â”€â”€ ğŸ“‚ presentation/
â”‚   â”‚   â”‚       â””â”€â”€ ğŸ“‚ controllers/
â”‚   â”‚   â”‚           â””â”€â”€ ğŸ“„ AuthController.test.ts # API endpoint testing
â”‚   â”‚   â””â”€â”€ ğŸ“‚ e2e/                             # End-to-End Tests
â”‚   â”‚       â”œâ”€â”€ ğŸ“‚ authentication/
â”‚   â”‚       â”‚   â”œâ”€â”€ ğŸ“„ login-flow.test.ts       # Complete authentication flow
â”‚   â”‚       â”‚   â””â”€â”€ ğŸ“„ otp-verification.test.ts # Complete OTP flow
â”‚   â”‚       â”œâ”€â”€ ğŸ“‚ user-management/
â”‚   â”‚       â”‚   â””â”€â”€ ğŸ“„ user-crud.test.ts        # Complete user management
â”‚   â”‚       â””â”€â”€ ğŸ“‚ role-management/
â”‚   â”‚           â””â”€â”€ ğŸ“„ rbac-flow.test.ts        # Complete RBAC flow
â”‚   â”‚
â”‚   â”œâ”€â”€ ğŸ“„ package.json                         # Backend Dependencies + Scripts
â”‚   â”œâ”€â”€ ğŸ“„ tsconfig.json                        # TypeScript Configuration
â”‚   â”œâ”€â”€ ğŸ“„ jest.config.js                       # Testing Configuration
â”‚   â”œâ”€â”€ ğŸ“„ eslint.config.js                     # Code Quality Rules
â”‚   â”œâ”€â”€ ğŸ“„ Dockerfile                           # Container Configuration
â”‚   â”œâ”€â”€ ğŸ“‚ prisma/
â”‚   â”‚   â””â”€â”€ ğŸ“„ schema.prisma                    # Database Schema
â”‚   â””â”€â”€ ğŸ“„ .env.example                         # Environment Variables Template
â”‚
â”œâ”€â”€ ğŸ“‚ k8s/                                     # Kubernetes Deployment
â”‚   â”œâ”€â”€ ğŸ“„ identity-deployment.yaml             # Service deployment
â”‚   â”œâ”€â”€ ğŸ“„ identity-service.yaml                # Service exposure
â”‚   â”œâ”€â”€ ğŸ“„ identity-configmap.yaml              # Configuration management
â”‚   â””â”€â”€ ğŸ“„ identity-secrets.yaml                # Secrets management
â”‚
â”œâ”€â”€ ğŸ“‚ monitoring/                              # Monitoring & Observability
â”‚   â”œâ”€â”€ ğŸ“‚ prometheus/
â”‚   â”‚   â””â”€â”€ ğŸ“„ identity-metrics.yaml            # Prometheus metrics
â”‚   â””â”€â”€ ğŸ“‚ grafana/
â”‚       â””â”€â”€ ğŸ“‚ dashboards/
â”‚           â””â”€â”€ ğŸ“„ identity-dashboard.json      # Grafana dashboard
â”‚
â”œâ”€â”€ ğŸ“‚ scripts/                                 # Automation Scripts
â”‚   â”œâ”€â”€ ğŸ“„ setup-identity-service.sh            # Service setup
â”‚   â”œâ”€â”€ ğŸ“„ deploy-identity-service.sh           # Deployment script
â”‚   â”œâ”€â”€ ğŸ“„ migrate-database.sh                  # Database migration
â”‚   â””â”€â”€ ğŸ“„ backup-identity-data.sh              # Data backup
â”‚
â”œâ”€â”€ ğŸ“‚ .github/                                 # CI/CD Workflows
â”‚   â””â”€â”€ ğŸ“‚ workflows/
â”‚       â”œâ”€â”€ ğŸ“„ identity-ci.yml                  # Continuous integration
â”‚       â””â”€â”€ ğŸ“„ identity-cd.yml                  # Continuous deployment
â”‚
â””â”€â”€ ğŸ“‚ docs/                                    # Documentation
    â”œâ”€â”€ ğŸ“‚ api/
    â”‚   â”œâ”€â”€ ğŸ“„ authentication-api.md            # Auth API documentation
    â”‚   â””â”€â”€ ğŸ“„ user-management-api.md           # User API documentation
    â”œâ”€â”€ ğŸ“‚ architecture/
    â”‚   â””â”€â”€ ğŸ“„ clean-architecture.md            # Architecture guide
    â”œâ”€â”€ ğŸ“‚ security/
    â”‚   â””â”€â”€ ğŸ“„ rbac-implementation.md           # RBAC implementation
    â”œâ”€â”€ ğŸ“‚ deployment/
    â”‚   â””â”€â”€ ğŸ“„ kubernetes-setup.md              # Deployment guide
    â”œâ”€â”€ ğŸ“‚ development/
    â”‚   â””â”€â”€ ğŸ“„ getting-started.md               # Developer setup
    â””â”€â”€ ğŸ“‚ testing/
        â””â”€â”€ ğŸ“„ testing-strategy.md              # Testing guidelines
```

---

## ğŸ“¦ **SHARED PACKAGES DEPENDENCIES**

### **Required NPM Packages:**
```json
{
  "dependencies": {
    "@psp/shared-core": "^1.2.0",           // Logger, validation, crypto utilities
    "@psp/shared-events": "^1.1.0",         // Domain events contracts
    "@psp/shared-database": "^1.0.5"        // DB connection utilities
  }
}
```

### **Import Pattern Examples:**
```typescript
// âœ… Import from shared packages
import { Logger, ValidationUtils, BaseException } from '@psp/shared-core';
import { UserCreatedEvent, UserDeletedEvent } from '@psp/shared-events';
import { DatabaseConnection, TransactionManager } from '@psp/shared-database';

// âœ… Import service-specific shared code
import { AuthenticationException } from '../shared/exceptions/AuthenticationException';
import { AUTH_CONSTANTS } from '../shared/constants/auth.constants';
import { passwordUtils } from '../shared/utils/password.utils';

// âœ… Domain imports
import { User } from '../domain/entities/User';
import { LoginUseCase } from '../application/use-cases/authentication/LoginUseCase';
```

### **Package Versions Management:**
```bash
# Update shared packages across services
npm update @psp/shared-core @psp/shared-events @psp/shared-database

# Lock specific versions for stability
npm install @psp/shared-core@1.2.0 --save-exact
```

---

## ğŸ”§ **IMPLEMENTATION CHECKLIST**

### **Phase 1: PROJECT SETUP & SHARED PACKAGES** âš™ï¸

#### **1.1 Khá»Ÿi táº¡o dá»± Ã¡n repository**
- [ ] **Táº¡o identity-auth-service repository**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part06.2.1 Layered Architecture + EMSA-v1.0 Standards
  - *MÃ´ táº£*: Thiáº¿t láº­p repository vá»›i Clean Architecture structure
  - *File táº¡o*: `package.json`, `README.md`, `.gitignore`, toÃ n bá»™ folder structure
  - *Ã nghÄ©a*: Single repository cho complete Identity service, EMSA-v1.0 compliant

#### **1.2 Setup Shared Packages Dependencies**
- [ ] **Install shared NPM packages**
  - *Tham chiáº¿u*: EMSA-v1.0 Package Standards
  - *MÃ´ táº£*: Install @psp/shared-core, @psp/shared-events, @psp/shared-database
  - *File táº¡o*: Updated `package.json` vá»›i proper versions
  - *Ã nghÄ©a*: Consistent shared utilities across microservices

#### **1.3 Configuration Files Setup**
- [ ] **Setup project configuration files**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part02.8 Technical Requirements
  - *MÃ´ táº£*: TypeScript, ESLint, Jest configurations theo EMSA-v1.0
  - *File táº¡o*: `tsconfig.json`, `eslint.config.js`, `jest.config.js`
  - *Ã nghÄ©a*: Standardized development environment

#### **1.4 Database Setup**
- [ ] **Thiáº¿t láº­p PostgreSQL cho user data**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part07.1 Data Model Overview
  - *MÃ´ táº£*: PostgreSQL 15+ vá»›i user management schema
  - *File táº¡o*: `backend/prisma/schema.prisma`, database connection configs
  - *Ã nghÄ©a*: ACID compliance cho sensitive user data

- [ ] **Thiáº¿t láº­p Redis cho sessions vÃ  cache**  
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part07.2.5 Session Management
  - *MÃ´ táº£*: Redis 7+ cho JWT sessions, OTP codes
  - *File táº¡o*: `backend/src/infrastructure/config/RedisConfig.ts`
  - *Ã nghÄ©a*: High-performance session management

### **Phase 2: BACKEND IMPLEMENTATION - CLEAN ARCHITECTURE** ğŸ—ï¸

#### **2.1 Domain Layer Implementation**
- [ ] **Implement Core Entities vá»›i business rules**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part04.1.4 User Management (FR-004)
  - *MÃ´ táº£*: Core business entities vá»›i validation, invariants, business logic
  - *File táº¡o*: `backend/src/domain/entities/User.ts`, `Role.ts`, `Permission.ts`, `Session.ts`, `OTPCode.ts`
  - *Ã nghÄ©a*: Encapsulate business logic, ensure data integrity

- [ ] **Implement Value Objects cho data integrity**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part05.7 Input Validation + Part05.3.2 Password Hashing
  - *MÃ´ táº£*: Immutable value objects vá»›i validation vÃ  business rules
  - *File táº¡o*: `backend/src/domain/value-objects/Email.ts`, `Phone.ts`, `Password.ts`
  - *Ã nghÄ©a*: Type safety, validation, vÃ  consistent data handling

- [ ] **Implement Repository Interfaces**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part06.2.1 Layered Architecture
  - *MÃ´ táº£*: Domain layer interfaces cho data access, dependency inversion
  - *File táº¡o*: `backend/src/domain/repositories/IUserRepository.ts`, `IRoleRepository.ts`, `ISessionRepository.ts`, `IOTPRepository.ts`
  - *Ã nghÄ©a*: Clean separation of concerns, testable domain logic

- [ ] **Implement Domain Services**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part04.1.3 User Authentication + Part04.1.5 OTP Verification
  - *MÃ´ táº£*: Complex business logic khÃ´ng thuá»™c vá» single entity
  - *File táº¡o*: `backend/src/domain/services/AuthenticationDomainService.ts`, `PasswordHashingService.ts`, `OTPGenerationService.ts`
  - *Ã nghÄ©a*: Complex business operations, cross-entity logic

#### **2.2 Application Layer Implementation**
- [ ] **Implement Authentication Use Cases**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part04.1.3 User Authentication (FR-003) + Part04.1.5 OTP Verification (FR-005)
  - *MÃ´ táº£*: Authentication workflows vá»›i OTP, session management
  - *File táº¡o*: `backend/src/application/use-cases/authentication/LoginUseCase.ts`, `LogoutUseCase.ts`, `RefreshTokenUseCase.ts`, `VerifyOTPUseCase.ts`
  - *Ã nghÄ©a*: Orchestrate authentication flows

- [ ] **Implement User Management Use Cases**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part04.1.4 User Management (FR-004)
  - *MÃ´ táº£*: Complete CRUD operations vá»›i validation, pagination
  - *File táº¡o*: `backend/src/application/use-cases/user-management/CreateUserUseCase.ts`, `UpdateUserUseCase.ts`, `DeleteUserUseCase.ts`, `GetUserUseCase.ts`, `ListUsersUseCase.ts`
  - *Ã nghÄ©a*: Support user management features vá»›i business logic

- [ ] **Implement Role Management Use Cases**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Access_Control_Tree_Grok.md Integration
  - *MÃ´ táº£*: RBAC operations, permission matrix, role hierarchy
  - *File táº¡o*: `backend/src/application/use-cases/role-management/AssignRoleUseCase.ts`, `CreateRoleUseCase.ts`, `UpdateRoleUseCase.ts`, `GetPermissionsUseCase.ts`
  - *Ã nghÄ©a*: Support sophisticated RBAC system

#### **2.3 Infrastructure Layer Implementation**
- [ ] **Implement Repository Implementations**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part07.2 Identity Database Design
  - *MÃ´ táº£*: Prisma-based repository implementations
  - *File táº¡o*: `backend/src/infrastructure/persistence/repositories/UserRepository.ts`, `RoleRepository.ts`, `SessionRepository.ts`, `OTPRepository.ts`
  - *Ã nghÄ©a*: Database access layer vá»›i proper abstraction

- [ ] **Implement External Service Adapters**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part09.1.1 Twilio Integration + Part09.1.3 Email Integration
  - *MÃ´ táº£*: Third-party service integrations (Twilio, SendGrid, Redis)
  - *File táº¡o*: `backend/src/infrastructure/external-services/TwilioAdapter.ts`, `SendGridAdapter.ts`, `RedisAdapter.ts`, `AuditLogAdapter.ts`
  - *Ã nghÄ©a*: External service integration vá»›i proper abstraction

#### **2.4 Presentation Layer Implementation**
- [ ] **Implement API Controllers**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part08.1.1 Authentication APIs + Part08.1.2 User Management APIs  
  - *MÃ´ táº£*: REST API controllers cho authentication vÃ  user management
  - *File táº¡o*: `backend/src/presentation/controllers/AuthController.ts`, `UserController.ts`, `RoleController.ts`, `HealthController.ts`
  - *Ã nghÄ©a*: API endpoints supporting complete functionality

- [ ] **Implement Security Middleware**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part05.3 Security Requirements + Access_Control_Tree_Grok.md
  - *MÃ´ táº£*: Authentication, authorization, validation middleware
  - *File táº¡o*: `backend/src/presentation/middleware/AuthMiddleware.ts`, `RBACMiddleware.ts`, `ValidationMiddleware.ts`, `LoggingMiddleware.ts`
  - *Ã nghÄ©a*: Security enforcement cho API access

#### **2.5 Service-Specific Shared Code Implementation**
- [ ] **Implement Service-Specific Constants**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part04.1.3 User Authentication + Access_Control_Tree_Grok.md
  - *MÃ´ táº£*: Authentication vÃ  RBAC constants ONLY
  - *File táº¡o*: `backend/src/shared/constants/auth.constants.ts`, `rbac.constants.ts`
  - *Ã nghÄ©a*: Service-specific configuration constants

- [ ] **Implement Service-Specific Exceptions**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part05.8 Error Handling
  - *MÃ´ táº£*: Authentication vÃ  authorization specific exceptions
  - *File táº¡o*: `backend/src/shared/exceptions/AuthenticationException.ts`, `AuthorizationException.ts`
  - *Ã nghÄ©a*: Structured error handling cho identity domain

#### **2.6 Domain Events**
- [ ] **Implement CRM Sync Event**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part04.3.3 CRM Integration
  - *MÃ´ táº£*: Event triggered sau user creation/update, publish qua RabbitMQ
  - *File táº¡o*: `backend/src/domain/events/UserSyncedToCRMEvent.ts`
  - *Ã nghÄ©a*: Integration vá»›i Integration Service (Sub-Project 6)

### **Phase 3: TESTING IMPLEMENTATION** ğŸ§ª

#### **3.1 Unit Testing**
- [ ] **Implement Domain Layer Tests**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part13.2.1 Unit Testing Framework
  - *MÃ´ táº£*: Unit tests cho entities, value objects, domain services
  - *File táº¡o*: `backend/tests/unit/domain/entities/*.test.ts`, `value-objects/*.test.ts`, `services/*.test.ts`
  - *Ã nghÄ©a*: Ensure domain logic correctness

- [ ] **Implement Application Layer Tests**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part13.2.1 Unit Testing Framework
  - *MÃ´ táº£*: Unit tests cho use cases vÃ  application logic
  - *File táº¡o*: `backend/tests/unit/application/use-cases/**/*.test.ts`
  - *Ã nghÄ©a*: Validate business workflows

#### **3.2 Integration Testing**
- [ ] **Implement Infrastructure Tests**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part13.2.2 Integration Testing
  - *MÃ´ táº£*: Integration tests cho database, external services
  - *File táº¡o*: `backend/tests/integration/infrastructure/**/*.test.ts`
  - *Ã nghÄ©a*: Validate external integrations

#### **3.3 End-to-End Testing**
- [ ] **Implement E2E Tests**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part13.2.3 E2E Testing
  - *MÃ´ táº£*: Complete workflow tests cho authentication flows
  - *File táº¡o*: `backend/tests/e2e/**/*.test.ts`
  - *Ã nghÄ©a*: Validate complete user journeys

### **Phase 4: DEPLOYMENT & DEVOPS** ğŸš€

#### **4.1 Containerization**
- [ ] **Create Docker Configuration**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part14.1 Container Orchestration + EMSA-v1.0 Docker Standards
  - *MÃ´ táº£*: Multi-stage Dockerfile cho production deployment
  - *File táº¡o*: `backend/Dockerfile`, `docker-compose.yml`
  - *Ã nghÄ©a*: Containerized deployment ready

#### **4.2 Kubernetes Deployment**
- [ ] **Create Kubernetes Manifests**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part14.1 Container Orchestration
  - *MÃ´ táº£*: K8s deployment, service, configmap, secrets
  - *File táº¡o*: `k8s/identity-deployment.yaml`, `identity-service.yaml`, `identity-configmap.yaml`, `identity-secrets.yaml`
  - *Ã nghÄ©a*: Production-ready Kubernetes deployment

#### **4.3 CI/CD Pipeline**
- [ ] **Setup GitHub Actions**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part15.2 CI/CD Pipelines
  - *MÃ´ táº£*: Automated testing, building, deployment pipeline
  - *File táº¡o*: `.github/workflows/identity-ci.yml`, `identity-cd.yml`
  - *Ã nghÄ©a*: Automated quality assurance vÃ  deployment

#### **4.4 Monitoring & Observability**
- [ ] **Setup Monitoring Stack**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part14.3 Monitoring Stack
  - *MÃ´ táº£*: Prometheus metrics, Grafana dashboards
  - *File táº¡o*: `monitoring/prometheus/identity-metrics.yaml`, `monitoring/grafana/dashboards/identity-dashboard.json`
  - *Ã nghÄ©a*: Production monitoring vÃ  alerting

### **Phase 5: DOCUMENTATION & MONITORING** ğŸ“š

#### **5.1 API Documentation**
- [ ] **Create API Documentation**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part08.1 API Design
  - *MÃ´ táº£*: Complete API documentation vá»›i examples
  - *File táº¡o*: `docs/api/authentication-api.md`, `user-management-api.md`, `API.md`
  - *Ã nghÄ©a*: Developer onboarding vÃ  service integration

#### **5.2 Architecture Documentation**
- [ ] **Create Architecture Guides**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part06.2.1 Layered Architecture + EMSA-v1.0
  - *MÃ´ táº£*: Clean Architecture implementation guide
  - *File táº¡o*: `docs/architecture/clean-architecture.md`, `docs/security/rbac-implementation.md`
  - *Ã nghÄ©a*: Architectural understanding vÃ  maintenance

#### **5.3 Automation Scripts**
- [ ] **Create Automation Scripts**
  - *Tham chiáº¿u*: SRS-Grok-V2.md - Part15.2 CI/CD Pipelines
  - *MÃ´ táº£*: Service setup, deployment, data management scripts
  - *File táº¡o*: `scripts/setup-identity-service.sh`, `deploy-identity-service.sh`, `migrate-database.sh`, `backup-identity-data.sh`
  - *Ã nghÄ©a*: Operational efficiency vÃ  consistency

---

## ğŸ¯ **Káº¾T LUáº¬N**

**Tá»•ng sá»‘ files Ä‘Æ°á»£c map**: 147 files vá»›i Ä‘áº§y Ä‘á»§ SRS references  
**Backend Clean Architecture**: 67 files vá»›i proper layering theo EMSA-v1.0  
**Shared Packages Integration**: 3 NPM packages cho cross-service utilities  
**API Coverage**: Complete REST endpoints cho Authentication, User Management, RBAC  
**Testing Strategy**: 30 test files coverage (Unit, Integration, E2E)  
**Deployment & DevOps**: 15 infrastructure files vá»›i K8s + monitoring  
**Documentation**: 10 comprehensive docs cho development + operations  

**Estimated timeline**: 6-8 tuáº§n cho 1 team (3-4 developers)  
**SRS coverage**: 100% cho Identity domain (FR-003, FR-004, FR-005)  
**EMSA-v1.0 compliance**: Full compliance vá»›i Clean Architecture standards  
**Integration points**: Ready cho Campaign, Redemption, Analytics services integration  
**Professional standards**: NPM packages approach, semantic versioning, CI/CD automation

**Sub-Project 1 hoÃ n chá»‰nh! Identity & Authentication Service vá»›i complete backend implementation theo EMSA-v1.0 vÃ  SRS specifications! ğŸš€**
